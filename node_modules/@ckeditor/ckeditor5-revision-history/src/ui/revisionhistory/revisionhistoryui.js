/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x121485,icons as _0x470d8e}from'ckeditor5/src/core.js';import{createDropdown as _0x2f7a03,ButtonView as _0x3422cc,ListItemView as _0x418e4b,ListView as te,MenuBarMenuListItemButtonView as _0x20789f,MenuBarMenuListItemView as _0x12740a,MenuBarMenuListView as _0x99912e,MenuBarMenuView as _0xdb27d8}from'ckeditor5/src/ui.js';import _0x21a772 from'../../revisiontracker.js';import _0x598601 from'./revisionhistorysaverevisionformview.js';import{getTranslation as _0x3926fa}from'../../utils/common-translations.js';export default class u extends _0x121485{static get['pluginName'](){return'RevisionHistoryUI';}static get['requires'](){return[_0x21a772];}['init'](){const _0x526b7c=this['editor'],_0x49372c=_0x526b7c['plugins']['get']('RevisionTracker');_0x526b7c['ui']['componentFactory']['add']('revisionHistory',_0x16d737=>{const _0x569903=_0x2f7a03(_0x16d737),_0x142071=_0x569903['panelView']['children'],_0x3a866a=new te(_0x16d737),_0x25fae4=new _0x418e4b(_0x16d737),_0x181748=new _0x3422cc(_0x16d737),_0x1318eb=new _0x418e4b(_0x16d737),_0x7907ec=new _0x3422cc(_0x16d737);return _0x569903['bind']('isEnabled')['to'](_0x49372c,'isReady',_0x49372c,'isEnabled',_0x526b7c,'isReadOnly',(_0x428970,_0x113611,_0x2422b9)=>_0x428970&&_0x113611&&!_0x2422b9),_0x569903['buttonView']['set']({'icon':_0x470d8e['history'],'label':_0x3926fa(_0x16d737,'Revision\x20history'),'tooltip':!0x0}),_0x181748['set']({'label':_0x3926fa(_0x16d737,'Save\x20current\x20revision'),'withText':!0x0,'role':'menuitem'}),_0x181748['bind']('isEnabled')['to'](_0x49372c,'isReady',_0x49372c,'isEnabled',_0x526b7c,'isReadOnly',(_0x26c0c0,_0x3fbdef,_0x11863e)=>_0x26c0c0&&_0x3fbdef&&!_0x11863e),_0x181748['on']('execute',()=>this['_showDialog']()),_0x7907ec['set']({'label':_0x3926fa(_0x16d737,'Open\x20revision\x20history'),'withText':!0x0,'role':'menuitem'}),_0x7907ec['bind']('isEnabled')['to'](_0x49372c,'isReady',_0x526b7c,'isReadOnly',(_0x2e7c6d,_0x14328e)=>_0x2e7c6d&&!_0x14328e),_0x7907ec['on']('execute',()=>{_0x526b7c['config']['get']('revisionHistory')['showRevisionViewerCallback'](),_0x569903['isOpen']=!0x1,_0x526b7c['editing']['view']['focus']();}),_0x25fae4['children']['add'](_0x181748),_0x1318eb['children']['add'](_0x7907ec),_0x3a866a['role']='menu',_0x3a866a['items']['addMany']([_0x25fae4,_0x1318eb]),_0x142071['add'](_0x3a866a),_0x569903;}),_0x526b7c['ui']['componentFactory']['add']('menuBar:revisionHistory',()=>this['_registerMenuComponent']());}['_registerMenuComponent'](){const _0x483cb5=this['editor'],_0x373bc8=_0x483cb5['locale'],_0x52bb55=new _0xdb27d8(_0x373bc8),_0x43249b=new _0x99912e(_0x373bc8);_0x52bb55['buttonView']['set']({'icon':_0x470d8e['history'],'label':_0x3926fa(_0x373bc8,'Revision\x20history')});const _0x1fac19=new _0x12740a(_0x373bc8,_0x52bb55),_0x4e4140=new _0x20789f(_0x373bc8);_0x4e4140['set']({'label':_0x3926fa(_0x373bc8,'Save\x20current\x20revision')}),_0x4e4140['delegate']('execute')['to'](_0x52bb55),_0x4e4140['on']('execute',()=>{this['_showDialog']();}),_0x1fac19['children']['add'](_0x4e4140),_0x43249b['items']['add'](_0x1fac19);const _0x189e07=new _0x12740a(_0x373bc8,_0x52bb55),_0xcd744d=new _0x20789f(_0x373bc8);return _0xcd744d['set']({'label':_0x3926fa(_0x373bc8,'Open\x20revision\x20history')}),_0xcd744d['delegate']('execute')['to'](_0x52bb55),_0xcd744d['on']('execute',()=>{_0x483cb5['config']['get']('revisionHistory')['showRevisionViewerCallback']();}),_0x189e07['children']['add'](_0xcd744d),_0x43249b['items']['add'](_0x189e07),_0x52bb55['panelView']['children']['add'](_0x43249b),_0x52bb55;}['_showDialog'](){const _0x212bcc=this['editor'],_0x5e87be=_0x212bcc['locale'],t=_0x5e87be['t'],_0x10f2f7=_0x212bcc['plugins']['get']('Dialog'),_0x113697=_0x212bcc['plugins']['get']('RevisionTracker');function _0x16091a(_0x464d3d){_0x212bcc['config']['get']('revisionHistory.requireRevisionName')&&''===_0x464d3d['revisionName']?_0x464d3d['revisionNameInputView']['errorText']=_0x3926fa(_0x5e87be,'The\x20revision\x20name\x20cannot\x20be\x20empty.'):(_0x212bcc['plugins']['get'](_0x21a772)['saveRevision']({'name':_0x464d3d['revisionName']}),_0x10f2f7['hide']());}this['_saveRevisionFormView']||(this['_createSaveRevisionFormView'](),this['_saveRevisionFormView']['on']('submit',()=>_0x16091a(this['_saveRevisionFormView']))),this['_saveRevisionFormView']['reset'](),_0x10f2f7['show']({'id':'revisionSave','title':_0x3926fa(_0x5e87be,'Save\x20current\x20revision'),'isModal':!0x0,'content':this['_saveRevisionFormView'],'actionButtons':[{'label':t('Cancel'),'withText':!0x0,'onExecute':()=>_0x10f2f7['hide']()},{'label':t('Accept'),'class':'ck-button-action','withText':!0x0,'onCreate'(_0x2f4270){_0x2f4270['bind']('isEnabled')['to'](_0x113697,'isReady',_0x113697,'isEnabled',_0x212bcc,'isReadOnly',(_0x207981,_0x81061d,_0x6de872)=>_0x207981&&_0x81061d&&!_0x6de872);},'onExecute':()=>_0x16091a(this['_saveRevisionFormView'])}]});}['_createSaveRevisionFormView'](){const _0x3b5a1a=this['editor'],_0x17418b=_0x3b5a1a['locale'];this['_saveRevisionFormView']=new _0x598601(_0x17418b,_0x3b5a1a['config']['get']('revisionHistory.requireRevisionName')),this['_saveRevisionFormView']['render']();}}