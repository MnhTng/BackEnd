/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Command as _0x27ff12,Plugin as _0x34015c}from'@ckeditor/ckeditor5-core/dist/index.js';import{ButtonView as _0x4ff81e,MenuBarMenuListItemButtonView as _0x2dfa3e,SpinnerView as _0x1b131c,Notification as _0x47423b}from'@ckeditor/ckeditor5-ui/dist/index.js';function f(){const _0x105258=[],_0x15d7a1=[];for(const _0x5265c6 of Array['from'](document['styleSheets'])){if(_0x5265c6['ownerNode']['hasAttribute']('data-cke')){for(const _0x486978 of Array['from'](_0x5265c6['cssRules']))-0x1!==_0x486978['cssText']['indexOf']('.ck-content')?_0x105258['push'](_0x486978['cssText']):-0x1!==_0x486978['cssText']['indexOf'](':root')&&_0x15d7a1['push'](_0x486978['cssText']);}}return _0x105258['length']||console['warn']('The\x20editor\x20stylesheet\x20could\x20not\x20be\x20found\x20in\x20the\x20document.\x20Check\x20your\x20webpack\x20config\x20â€“\x20style-loader\x20should\x20use\x20data-cke=true\x20attribute\x20for\x20the\x20editor\x20stylesheet.'),[..._0x15d7a1,..._0x105258]['join']('\x20')['trim']();}function d(_0x60122f){const _0x4d965b=_0x60122f['plugins']['has']('Users'),_0x1ce319=_0x60122f['plugins']['has']('CommentsRepository'),_0x5cdff2=_0x60122f['plugins']['has']('TrackChanges'),_0x54eecc={};if(_0x4d965b&&_0x1ce319){const _0x483794=function(_0x3721f3){const _0x5dcb14={};if(!_0x3721f3['length'])return _0x5dcb14;for(const _0x245c5c of _0x3721f3)_0x245c5c['comments']['map'](_0x379fa8=>{void 0x0===_0x5dcb14[_0x245c5c['id']]&&(_0x5dcb14[_0x245c5c['id']]=[]),_0x5dcb14[_0x245c5c['id']]['push']({'author':_0x379fa8['author']['name'],'content':_0x379fa8['content'],'created':_0x379fa8['createdAt'],'is_resolved':_0x245c5c['isResolved']});});return _0x5dcb14;}(_0x60122f['plugins']['get']('CommentsRepository')['getCommentThreads']({'skipNotAttached':!0x0,'skipEmpty':!0x0}));Object['keys'](_0x483794)['length']&&(_0x54eecc['comments']=_0x483794);}if(_0x4d965b&&_0x5cdff2){const _0x4ad054=_0x60122f['plugins']['get']('TrackChanges'),_0x30ca64=_0x60122f['plugins']['get']('Users'),_0xb55fb5=function(_0x57cb16,_0x3a5674){const _0x2eaa0d={};if(!_0x57cb16['length']||!_0x3a5674['length'])return _0x2eaa0d;for(const _0x5634e7 of _0x57cb16)_0x2eaa0d[_0x5634e7['id']]={'author':_0x3a5674['get'](_0x5634e7['authorId'])['name'],'created':_0x5634e7['createdAt']};return _0x2eaa0d;}(_0x4ad054['getSuggestions']({'toJSON':!0x0}),_0x30ca64['users']);Object['keys'](_0xb55fb5)['length']&&(_0x54eecc['suggestions']=_0xb55fb5);}return(_0x54eecc['suggestions']||_0x54eecc['comments'])&&(_0x54eecc['timezone']=new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']),_0x54eecc;}function h(_0x22fb12){const _0x177b1d=_0x22fb12['plugins']['has']('Users'),_0xcf406=_0x22fb12['plugins']['has']('CommentsRepository'),_0x839a85=_0x22fb12['plugins']['has']('TrackChanges'),_0x2a7c0c={},_0x23c26a={};if(_0x177b1d&&_0xcf406){const _0x5dd71e=function(_0x1c4e54){const _0x516a34=[];if(!_0x1c4e54['length'])return _0x516a34;for(const _0x5f10b6 of _0x1c4e54){const _0x4d8d64=_0x5f10b6['comments']['map'](_0x5d6bb8=>({'author':_0x5d6bb8['author']['name'],'content':_0x5d6bb8['content'],'created_at':_0x5d6bb8['createdAt']}));_0x516a34['push']({'thread_id':_0x5f10b6['id'],'is_resolved':_0x5f10b6['isResolved'],'comments':_0x4d8d64});}return _0x516a34;}(_0x22fb12['plugins']['get']('CommentsRepository')['getCommentThreads']({'skipNotAttached':!0x0,'skipEmpty':!0x0}));_0x5dd71e['length']&&(_0x23c26a['comment_threads']=_0x5dd71e);}if(_0x177b1d&&_0x839a85){const _0x3112b8=_0x22fb12['plugins']['get']('TrackChanges'),_0x3960a3=_0x22fb12['plugins']['get']('Users'),_0x2f79d5=function(_0xdb9aee,_0xbab38a){if(!_0xdb9aee['length']||!_0xbab38a['length'])return[];return _0xdb9aee['map'](_0x15702d=>({'id':_0x15702d['id'],'author':_0xbab38a['get'](_0x15702d['authorId'])['name'],'created_at':_0x15702d['createdAt']}));}(_0x3112b8['getSuggestions']({'toJSON':!0x0}),_0x3960a3['users']);_0x2f79d5['length']&&(_0x23c26a['suggestions']=_0x2f79d5);}return(_0x23c26a['comment_threads']||_0x23c26a['suggestions'])&&(_0x2a7c0c['timezone']=new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone'],_0x2a7c0c['collaboration_features']=_0x23c26a),_0x2a7c0c;}class e extends _0x27ff12{constructor(_0x3ec59f){super(_0x3ec59f),this['set']('isBusy',!0x1),this['affectsData']=!0x1;}['refresh'](){this['isEnabled']=!this['isBusy'],this['value']=this['isBusy']?'pending':void 0x0;}['execute'](_0xb20c3={}){const _0x51cb44=this['editor'],t=_0x51cb44['t'],_0x3bd979=0x2===(_0xb20c3['version']||0x1),_0xc8eea7=_0xb20c3['converterUrl']||(_0x3bd979?'https://docx-converter.cke-cs.com/v2/convert/html-docx':'https://docx-converter.cke-cs.com/v1/convert'),_0x180b0c=_0xb20c3['converterOptions']||{},_0x4ddf70=_0x51cb44['plugins']['get']('ExportWord'),_0x43b7e1=_0xb20c3['token']||_0x4ddf70['_token'],_0x48433c=!0x1!==_0x180b0c['auto_pagination'],_0x33f628=_0xb20c3['dataCallback']||(_0xd751b=>_0xd751b['data']['get']({'pagination':_0x48433c}));return this['isBusy']=!0x0,this['refresh'](),function(_0x260740){if(!_0x260740)return new Promise(_0x3bd1e2=>_0x3bd1e2(''));const _0x127b84=[];for(const _0x20e122 of _0x260740)'EDITOR_STYLES'!==_0x20e122?_0x127b84['push'](window['fetch'](_0x20e122)['then'](_0x1cfafb=>_0x1cfafb['text']())):_0x127b84['push'](f());return Promise['all'](_0x127b84)['then'](_0x208837=>_0x208837['join']('\x20')['trim']());}(_0xb20c3['stylesheets']||['EDITOR_STYLES'])['then'](async _0xb5bb8d=>{_0x51cb44['ui']['ariaLiveAnnouncer']['announce'](t('Word\x20document\x20export\x20started'));const _0xc48efc=await _0x33f628(_0x51cb44),_0x46ab05={'html':'<div\x20class=\x22ck-content\x22\x20dir=\x22'+_0x51cb44['locale']['contentLanguageDirection']+'\x22>'+_0xc48efc+'</div>','css':_0xb5bb8d,[_0x3bd979?'config':'options']:{..._0x180b0c,..._0x3bd979?h(_0x51cb44):d(_0x51cb44)}},_0xce7ac3={'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/docx',..._0x43b7e1?{'Authorization':_0x43b7e1['value']}:null},'body':JSON['stringify'](_0x46ab05)};return window['fetch'](_0xc8eea7,_0xce7ac3)['then'](_0x166c63=>{if(0xc8!==_0x166c63['status'])throw _0x166c63;return _0x166c63['blob']();})['then'](_0x81e7ef=>{_0x51cb44['ui']['ariaLiveAnnouncer']['announce'](t('Word\x20document\x20export\x20successful'));const _0x2d80c2='function'==typeof _0xb20c3['fileName']?_0xb20c3['fileName']():_0xb20c3['fileName'];this['_downloadFile'](_0x81e7ef,_0x2d80c2||'document.docx');});})['catch'](_0x4c8852=>{const _0x513c86=_0x51cb44['plugins']['get']('Notification');throw _0x51cb44['ui']['ariaLiveAnnouncer']['announce'](t('Word\x20document\x20export\x20failed'),{'politeness':'assertive'}),_0x513c86['showWarning'](t('An\x20error\x20occurred\x20while\x20generating\x20the\x20Word\x20file.')),_0x4c8852;})['finally'](()=>{this['isBusy']=!0x1,this['refresh']();});}['_downloadFile'](_0x5f3696,_0x453721){const _0x793beb=document['createElement']('a');_0x793beb['href']=window['URL']['createObjectURL'](_0x5f3696),_0x793beb['download']=_0x453721,_0x793beb['click'](),_0x793beb['remove']();}}class i extends _0x34015c{static get['pluginName'](){return'ExportWordUI';}['init'](){const _0x24621f=this['editor'];_0x24621f['ui']['componentFactory']['add']('exportWord',()=>{const _0x207087=_0x24621f['commands']['get']('exportWord'),_0xcf43d1=this['_createButton'](_0x4ff81e);return _0xcf43d1['set']({'tooltip':!0x0}),_0xcf43d1['bind']('isOn')['to'](_0x207087,'isBusy'),_0xcf43d1;}),_0x24621f['ui']['componentFactory']['add']('menuBar:exportWord',()=>this['_createButton'](_0x2dfa3e));}['_createButton'](_0x3f3d48){const _0xebac26=this['editor'],_0x4f7c86=_0xebac26['config']['get']('exportWord')||{},t=_0xebac26['locale']['t'],_0x53af90=_0xebac26['commands']['get']('exportWord'),_0x38c4f9=new _0x3f3d48(_0xebac26['locale']),_0x42dd8d=new _0x1b131c();return _0x38c4f9['children']['add'](_0x42dd8d),_0x42dd8d['bind']('isVisible')['to'](_0x53af90,'isBusy'),_0x38c4f9['iconView']['bind']('isVisible')['to'](_0x53af90,'isBusy',_0x2ffbbb=>!_0x2ffbbb),_0x38c4f9['set']({'icon':'<svg\x20viewBox=\x220\x200\x2020\x2020\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22M17.826\x2016.843a.75.75\x200\x200\x200-1.152-.96L15.5\x2017.29V12H14v5.29l-1.174-1.408a.75.75\x200\x200\x200-1.152.96l2.346\x202.816a.95.95\x200\x200\x200\x201.46\x200l2.346-2.815Z\x22/><path\x20d=\x22m14\x200\x205\x204.5v9.741a2.737\x202.737\x200\x200\x200-1.5-.617V6.5h-5v-5h-8v3H3V0h11Zm0\x202v3h3.3L14\x202Z\x22/><path\x20d=\x22M3\x2017.5h6.746c.1.22.23.429.391.623l.731.877H3v-1.5Z\x22/><path\x20d=\x22M8.5\x206a1.5\x201.5\x200\x200\x201\x201.493\x201.356L10\x207.5v7a1.5\x201.5\x200\x200\x201-1.356\x201.493L8.5\x2016h-7a1.5\x201.5\x200\x200\x201-1.493-1.356L0\x2014.5v-7a1.5\x201.5\x200\x200\x201\x201.356-1.493L1.5\x206h7ZM7.483\x208.795l-.042.088-.986\x202.534-.947-2.528-.043-.092a.601.601\x200\x200\x200-1.042.008l-.042.093-.883\x202.465-.937-2.475-.042-.089a.6.6\x200\x200\x200-1.107.42l.027.093\x201.514\x204\x20.044.092a.6.6\x200\x200\x200\x201.041-.01l.041-.092.88-2.458.925\x202.467.046.096a.6.6\x200\x200\x200\x201.032\x200l.043-.09\x201.554-4\x20.028-.093a.6.6\x200\x200\x200-1.104-.43v.001Z\x22/></svg>\x0a'}),_0x38c4f9['bind']('isEnabled')['to'](_0x53af90,'isEnabled'),_0x38c4f9['bind']('label')['to'](_0x53af90,'isBusy',_0x173a93=>t(_0x173a93?'Exporting\x20Word\x20document':'Export\x20to\x20Word')),this['listenTo'](_0x38c4f9,'execute',()=>{_0xebac26['execute']('exportWord',_0x4f7c86),_0xebac26['editing']['view']['focus']();}),_0x38c4f9;}}class s extends _0x34015c{['_token'];static get['pluginName'](){return'ExportWord';}static get['requires'](){return['CloudServices',_0x47423b,i];}['init'](){const _0x177d5e=this['editor'],_0x4768b6=_0x177d5e['config']['get']('exportWord')||{};_0x177d5e['commands']['add']('exportWord',new e(_0x177d5e));const _0x5c1a5e=_0x177d5e['plugins']['get']('CloudServices');!0x1===_0x4768b6['tokenUrl']?this['_token']=null:_0x4768b6['tokenUrl']?_0x5c1a5e['registerTokenUrl'](_0x4768b6['tokenUrl'])['then'](_0x2c5d5c=>{this['_token']=_0x2c5d5c;}):this['_token']=_0x5c1a5e['token'];}}export{s as ExportWord};