/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x41a1a0}from'ckeditor5/src/core.js';import{CKEditorError as _0x41e956}from'ckeditor5/src/utils.js';import _0x5268c6 from'./paginationlookup.js';import _0x4ebc10 from'./paginationrenderer.js';import'../theme/pagination.css';export default class s extends _0x41a1a0{static get['pluginName'](){return'PaginationEditing';}static get['requires'](){return[_0x5268c6,_0x4ebc10];}['init'](){this['set']({'pageNumber':0x1,'totalPages':0x1});const _0x2babbb=this['editor']['plugins']['get']('Pagination'),_0x138a46=this['editor']['plugins']['get'](_0x5268c6),_0x2db919=this['editor']['plugins']['get'](_0x4ebc10);this['bind']('isEnabled')['to'](_0x2babbb),this['_setUpDataDowncastConversion'](),this['bind']('pageNumber')['to'](_0x2db919),this['listenTo'](_0x138a46,'change:pageBreaks',(_0x246579,_0x4aaca2,_0xb5cd3,_0x17c387)=>{this['totalPages']=_0xb5cd3['length'],this['_updatePageBreakMarkers'](_0xb5cd3,_0x17c387);}),this['_setupKeystrokes']();const _0x1b9015=this['editor'];this['licenseKey']=_0x1b9015['config']['get']('licenseKey'),this['_licenseKeyCheckInterval']=setInterval(()=>{let _0x54ff81;for(const _0xd07f07 in _0x1b9015){const _0x20ae24=_0xd07f07,_0x3dddfc=_0x1b9015[_0x20ae24];if('paginationLicenseKeyTrial'===_0x3dddfc||'paginationLicenseKeyInvalid'===_0x3dddfc||'paginationLicenseKeyValid'===_0x3dddfc||'paginationLicenseKeyTrialLimit:operations'===_0x3dddfc){delete _0x1b9015[_0x20ae24],_0x54ff81=_0x3dddfc;break;}}if('paginationLicenseKeyInvalid'===_0x54ff81)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x41e956('pagination-invalid-license-key',null);if('paginationLicenseKeyTrial'===_0x54ff81&&console['info']('You\x20are\x20using\x20the\x20trial\x20version\x20of\x20CKEditor\x205\x20pagination\x20plugin\x20with\x20limited\x20usage.\x20Make\x20sure\x20you\x20will\x20not\x20use\x20it\x20in\x20the\x20production\x20environment.'),'paginationLicenseKeyTrialLimit:operations'===_0x54ff81)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x41e956('pagination-trial-license-key-reached-limit-changes',null);'paginationLicenseKeyValid'===_0x54ff81&&clearInterval(this['_licenseKeyCheckInterval']);},0x3e8);}['destroy'](){clearInterval(this['_licenseKeyCheckInterval']);}['scrollToPage'](_0x39ea52){if(!this['isEnabled'])return;this['editor']['plugins']['get'](_0x4ebc10)['scrollToPage'](this['_validatePageNumber'](_0x39ea52));}['moveSelectionToPage'](_0x43a8e1){if(!this['isEnabled'])return;const _0x5cae3c=this['editor'],_0x2f9597=this['editor']['plugins']['get'](_0x5268c6)['pageBreaks'][_0x43a8e1-0x1];_0x2f9597&&_0x5cae3c['model']['change'](_0x2b6401=>{switch(_0x2f9597['type']){case'manual':{const _0x16977a=_0x5cae3c['model']['schema']['getNearestSelectionRange'](_0x2f9597['modelRange']['end'],'forward');_0x2b6401['setSelection'](_0x16977a);break;}case'element':{const _0x4888eb=_0x5cae3c['model']['schema']['getNearestSelectionRange'](_0x2f9597['modelRange']['start'],'forward');_0x2b6401['setSelection'](_0x4888eb);break;}case'text':{const _0x201b26=_0x2f9597['modelRange']['start'];if('\x20'===_0x201b26['textNode']['data'][_0x201b26['offset']]){const _0x35e822=_0x2b6401['createPositionAt'](_0x201b26['parent'],_0x201b26['offset']+0x1);_0x2b6401['setSelection'](_0x35e822);}else _0x2b6401['setSelection'](_0x2f9597['modelRange']);}}_0x5cae3c['editing']['view']['focus']();});}['goToNextPage'](){const _0x101aa2=this['_validatePageNumber'](this['pageNumber']+0x1);this['moveSelectionToPage'](_0x101aa2),this['scrollToPage'](_0x101aa2);}['goToPreviousPage'](){const _0x3568e4=this['_validatePageNumber'](this['pageNumber']-0x1);this['moveSelectionToPage'](_0x3568e4),this['scrollToPage'](_0x3568e4);}['_updatePageBreakMarkers'](_0x32bb76,_0x1db674){const _0x4275e6=this['editor']['model'];this['isEnabled']&&_0x4275e6['change'](_0x32ecd4=>{for(let _0x36ab5e=0x1;_0x36ab5e<_0x32bb76['length'];_0x36ab5e++){const _0x5c155c=_0x32bb76[_0x36ab5e]['modelRange'],_0x12e4a2='pagination:'+(_0x36ab5e+0x1);_0x4275e6['markers']['has'](_0x12e4a2)?_0x32ecd4['updateMarker'](_0x12e4a2,{'range':_0x5c155c}):_0x32ecd4['addMarker'](_0x12e4a2,{'range':_0x5c155c,'usingOperation':!0x1,'affectsData':!0x0});}for(let _0x3c4343=_0x32bb76['length'];_0x3c4343<_0x1db674['length'];_0x3c4343++){const _0x52a9bc='pagination:'+(_0x3c4343+0x1);_0x4275e6['markers']['has'](_0x52a9bc)&&_0x32ecd4['removeMarker'](_0x52a9bc);}});}['_setUpDataDowncastConversion'](){const _0x49113f='pagination';this['editor']['conversion']['for']('dataDowncast')['add'](_0x2264db=>{_0x2264db['on']('addMarker:'+_0x49113f,(_0x365bd3,{markerRange:_0x33afd7,markerName:_0x6eb778},_0x2b3358)=>{if(!_0x2b3358['options']['pagination'])return;if(!_0x2b3358['consumable']['consume'](_0x33afd7,_0x365bd3['name']))return;const _0x21aa2b=_0x33afd7['getContainedElement']();let _0x376d71=_0x21aa2b?_0x2b3358['mapper']['toViewElement'](_0x21aa2b):null;if(!_0x376d71){const _0x3a786a=_0x33afd7['start'];if(_0x2b3358['schema']['checkChild'](_0x3a786a,'$text')){const _0x232ec7=_0x2b3358['mapper']['toViewPosition'](_0x3a786a);_0x376d71=_0x2b3358['writer']['createContainerElement']('span'),_0x376d71['getFillerOffset']=()=>null,_0x2b3358['writer']['insert'](_0x232ec7,_0x376d71);}else{const _0x2727cf=_0x3a786a['nodeAfter'];_0x376d71=_0x2b3358['mapper']['toViewElement'](_0x2727cf);}}for(;_0x376d71['parent']!==_0x376d71['root']&&0x0===_0x376d71['index'];)_0x376d71=_0x376d71['parent'];const _0x416e22=_0x6eb778['substring'](0xb);_0x2b3358['writer']['setStyle']('page-break-before','always',_0x376d71),_0x2b3358['writer']['setAttribute']('data-pagination-page',_0x416e22,_0x376d71),_0x2b3358['mapper']['bindElementToMarker'](_0x376d71,_0x6eb778),_0x365bd3['stop']();});});}['_setupKeystrokes'](){const _0x4554d9=this['editor'],t=_0x4554d9['locale']['t'];_0x4554d9['keystrokes']['set']('Shift+Pageup',(_0x3951a8,_0x2ab815)=>{this['goToPreviousPage'](),_0x2ab815();}),_0x4554d9['keystrokes']['set']('Shift+Pagedown',(_0x185956,_0x38e704)=>{this['goToNextPage'](),_0x38e704();}),_0x4554d9['accessibility']['addKeystrokeInfoGroup']({'id':'pagination','label':t('Keystrokes\x20for\x20navigating\x20through\x20documents'),'keystrokes':[{'label':t('Go\x20to\x20the\x20previous\x20page\x20(also\x20move\x20selection)'),'keystroke':'Shift+Pageup','mayRequireFn':!0x0},{'label':t('Go\x20to\x20the\x20next\x20page\x20(also\x20move\x20selection)'),'keystroke':'Shift+Pagedown','mayRequireFn':!0x0}]});}['_validatePageNumber'](_0x50996d){return _0x50996d<0x1&&(_0x50996d=0x1),_0x50996d>this['totalPages']&&(_0x50996d=this['totalPages']),_0x50996d;}}