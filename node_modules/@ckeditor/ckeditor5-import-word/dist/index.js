/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0xd0e1d6,Command as _0x597675}from'@ckeditor/ckeditor5-core/dist/index.js';import{FileDialogButtonView as _0x2962a9,MenuBarMenuListItemFileDialogButtonView as _0x5beece,SpinnerView as _0x1f763a,Notification as _0x3036db}from'@ckeditor/ckeditor5-ui/dist/index.js';import{ClipboardPipeline as _0x344e4a}from'@ckeditor/ckeditor5-clipboard/dist/index.js';import{Range as _0x2c1487}from'@ckeditor/ckeditor5-engine/dist/index.js';import{first as _0x20736e,uid as _0x5ab67d,logWarning as _0x331145,logError as _0xfc6c34}from'@ckeditor/ckeditor5-utils/dist/index.js';class o extends _0xd0e1d6{static get['pluginName'](){return'ImportWordUI';}['init'](){const _0x558747=this['editor'];_0x558747['ui']['componentFactory']['add']('importWord',()=>{const _0x169e73=this['_createButton'](_0x2962a9),_0x25d212=_0x558747['commands']['get']('importWord');return _0x169e73['bind']('isOn')['to'](_0x25d212,'isBusy'),_0x169e73['tooltip']=!0x0,_0x169e73;}),_0x558747['ui']['componentFactory']['add']('menuBar:importWord',()=>this['_createButton'](_0x5beece));}['_createButton'](_0x426b45){const _0x55584e=this['editor'],t=_0x55584e['locale']['t'],_0x1d568b=_0x55584e['commands']['get']('importWord'),_0x4772a7=new _0x426b45(_0x55584e['locale']),_0x30b4c1=new _0x1f763a();return _0x4772a7['set']({'acceptedType':'application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template'}),_0x4772a7['set']({'icon':'<svg\x20viewBox=\x220\x200\x2020\x2020\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22m14\x200\x205\x204.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0\x202v3h3.3L14\x202Z\x22/><path\x20d=\x22M10.74\x2018a2.76\x202.76\x200\x200\x201-.469-.5H3V19h9.25v-.374A2.737\x202.737\x200\x200\x201\x2010.74\x2018Z\x22/><path\x20d=\x22M8.5\x206a1.5\x201.5\x200\x200\x201\x201.493\x201.356L10\x207.5v7a1.5\x201.5\x200\x200\x201-1.356\x201.493L8.5\x2016h-7a1.5\x201.5\x200\x200\x201-1.493-1.356L0\x2014.5v-7a1.5\x201.5\x200\x200\x201\x201.356-1.493L1.5\x206h7ZM7.483\x208.795l-.042.088-.986\x202.534-.947-2.528-.043-.092a.601.601\x200\x200\x200-1.042.008l-.042.093-.883\x202.465-.937-2.475-.042-.089a.6.6\x200\x200\x200-1.107.42l.027.093\x201.514\x204\x20.044.092a.6.6\x200\x200\x200\x201.041-.01l.041-.092.88-2.458.925\x202.467.046.096a.602.602\x200\x200\x200\x201.032\x200l.043-.09\x201.554-4\x20.028-.093a.6.6\x200\x200\x200-1.104-.43v.001ZM11.674\x2015.407a.75.75\x200\x201\x200\x201.152.96L14\x2014.96V20h1.5v-5.04l1.174\x201.408a.75.75\x200\x201\x200\x201.152-.96l-2.346-2.816a.95.95\x200\x200\x200-1.46\x200l-2.346\x202.815Z\x22/></svg>\x0a'}),_0x4772a7['bind']('isEnabled')['to'](_0x1d568b),_0x4772a7['bind']('label')['to'](_0x1d568b,'isBusy',_0x10a7f0=>t(_0x10a7f0?'Importing\x20Word\x20document':'Import\x20from\x20Word')),_0x30b4c1['bind']('isVisible')['to'](_0x1d568b,'isBusy'),_0x4772a7['iconView']['bind']('isVisible')['to'](_0x1d568b,'isBusy',_0x456e10=>!_0x456e10),_0x4772a7['children']['add'](_0x30b4c1),_0x4772a7['on']('done',(_0x2113e2,_0x311fe4)=>{_0x55584e['execute']('importWord',_0x311fe4[0x0],{}),_0x55584e['editing']['view']['focus']();}),_0x4772a7;}}class d extends _0x597675{['_importMarker'];['_undoStepBatch'];['_abortController'];constructor(_0x1e7a36){super(_0x1e7a36),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x538c4a,_0x2de83f)=>{const _0x5d6c5f=new DataTransfer();_0x5d6c5f['setData']('text/html',_0x2de83f['html']);const _0x5dce02=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x23e122=>{this['_importMarker']['stopListening'](),_0x23e122['setSelection'](_0x5dce02),_0x1e7a36['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x5d6c5f});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x180a84,_0x488a02={}){if(this['isBusy'])return Promise['resolve']();const _0x4cf3f7=this['editor']['config']['get']('importWord'),_0x31ce67={'url':_0x4cf3f7['converterUrl'],'file':_0x180a84,'serviceConfig':{..._0x488a02,'formatting':_0x4cf3f7['formatting']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x31ce67)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x9ee1a5=this['editor']['model'],_0x3a0ca6=_0x9ee1a5['schema'],_0x28c00e=_0x9ee1a5['document']['selection'],_0x40dcb7=_0x20736e(_0x28c00e['getSelectedBlocks']());return!!_0x40dcb7&&_0x3a0ca6['checkChild'](_0x40dcb7['parent'],'paragraph');}['_prepareForImport'](){const _0x39a04a=this['editor'],_0x3176d5=_0x39a04a['model'],_0x35e33b=_0x3176d5['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x39a04a['model']['createBatch']({'isUndoable':!0x0}),_0x3176d5['enqueueChange'](this['_undoStepBatch'],_0x23103f=>{_0x35e33b['isCollapsed']||_0x3176d5['deleteContent'](_0x35e33b,{'leaveUnmerged':!0x0});const _0x34424c=_0x35e33b['getFirstPosition'](),_0x5cdef6=_0x20736e(_0x35e33b['getSelectedBlocks']());let _0x3589d8;_0x3589d8=_0x5cdef6['is']('element','paragraph')&&_0x5cdef6['isEmpty']?_0x34424c:_0x34424c['isAtStart']?_0x3176d5['createPositionBefore'](_0x5cdef6):_0x34424c['isAtEnd']?_0x3176d5['createPositionAfter'](_0x5cdef6):_0x23103f['split'](_0x34424c)['position'],this['_importMarker']=_0x23103f['addMarker']('importWord:'+_0x5ab67d(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x2c1487(_0x3589d8)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x1fac14=this['editor']['model'];_0x1fac14['markers']['has'](this['_importMarker'])&&_0x1fac14['enqueueChange'](this['_undoStepBatch'],_0xc893df=>{_0xc893df['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0xe0b96d,file:_0x390caa,serviceConfig:_0x231561}){const _0x8eb14c=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x50b30e=new FormData();_0x50b30e['set']('config',JSON['stringify'](_0x231561)),_0x50b30e['set']('file',_0x390caa);const _0x4ee896={'method':'POST','headers':{},'body':_0x50b30e,'signal':this['_abortController']['signal']};return _0x8eb14c&&(_0x4ee896['headers']['Authorization']=_0x8eb14c['value']),fetch(_0xe0b96d,_0x4ee896);}['_handleImportResponse'](_0x29d1fa){return _0x29d1fa['ok']?_0x29d1fa['json']()['then'](_0x137a9a=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x137a9a);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x331145('import-word-plugin-import-cancelled');const _0x2ce7c7=this['editor'],_0x1d2d72=(0x0,_0x2ce7c7['t'])('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x2ce7c7['plugins']['get']('Notification')['showWarning'](_0x1d2d72),_0xfc6c34('import-word-plugin-conversion-failed');}}class e extends _0xd0e1d6{['_token'];static get['pluginName'](){return'ImportWordEditing';}static get['requires'](){return[_0x3036db,_0x344e4a,'CloudServices'];}constructor(_0x2a41ca){super(_0x2a41ca),this['_token']=null;}async['init'](){const _0x5423ce=this['editor'];_0x5423ce['config']['define']('importWord',{'converterUrl':'https://docx-converter.cke-cs.com/v2/convert/docx-html','tokenUrl':(_0x5423ce['config']['get']('cloudServices')||{})['tokenUrl'],'formatting':{'resets':'none','defaults':'none','styles':'inline'}}),_0x5423ce['commands']['add']('importWord',new d(_0x5423ce));const {tokenUrl:_0x193e5c}=_0x5423ce['config']['get']('importWord');if(_0x193e5c){const {tokenUrl:_0x371c0e}=_0x5423ce['config']['get']('cloudServices')||{};this['_token']=_0x193e5c===_0x371c0e?_0x5423ce['plugins']['get']('CloudServices')['token']:await _0x5423ce['plugins']['get']('CloudServices')['registerTokenUrl'](_0x193e5c);}}['getToken'](){return this['_token'];}}class i extends _0xd0e1d6{static get['pluginName'](){return'ImportWord';}static get['requires'](){return[e,o];}}export{i as ImportWord,e as ImportWordEditing,o as ImportWordUI};