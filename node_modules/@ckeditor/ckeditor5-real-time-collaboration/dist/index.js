/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{ContextPlugin as _0xcc61e9,Plugin as _0x24fdff,PendingActions as _0x2a390c,Context as _0x2ed358}from'@ckeditor/ckeditor5-core/dist/index.js';import{DomEmitterMixin as _0xeda1f3,CKEditorError as _0x7d2c8e,Collection as _0x223e77,global as _0x51c3dd,version as nt,uid as _0x5b9fef}from'@ckeditor/ckeditor5-utils/dist/index.js';import{Notification as _0x2374c4,View as _0x3d2e32,BalloonPanelView as _0x1e6801,clickOutsideHandler as _0x443e4a,BodyCollection as _0x3291e9}from'@ckeditor/ckeditor5-ui/dist/index.js';import{LiveRange as ht,History as _0x33cb73,NoOperation as _0x1ae3f4,InsertOperation as _0xd54622,MarkerOperation as _0x344765,RootAttributeOperation as _0xb0d04f,transformSets as _0x2b4463,OperationFactory as _0x1da48c}from'@ckeditor/ckeditor5-engine/dist/index.js';import{WebSocketGateway as at,WEB_SOCKET_GATEWAY_STATES as _0x5ce1bc,CollaborativeEditingService as _0x4b38a7,User as dt,CommentsService as _0x2ce4d9,TrackChangesService as et,RevisionHistoryService as it,EditorService as tt}from'@ckeditor/ckeditor-cloud-services-collaboration/dist/index.js';import{Users as _0x56c9c0,UserView as ct}from'ckeditor5-collaboration/dist/index.js';import{Compressor as _0x265e28}from'@ckeditor/ckeditor5-operations-compressor/dist/index.js';import{isElement as _0x351fa7}from'lodash-es';class c extends _0xcc61e9{static ['WebSocketGateway']=/* #__PURE__ -- @preserve */
((()=>at)());static ['initialReconnectionInterval']=0x3e8;['connection'];['_reconnectionStack'];['_shouldPluginsReconnect'];['_domEmitter'];static get['requires'](){return['CloudServices',_0x2374c4];}static get['pluginName'](){return'WebSocketGateway';}constructor(_0x412132){super(_0x412132),this['set']('state',_0x5ce1bc['CONNECTED']),this['set']('_isBrowserOffline',!0x1),this['_reconnectionStack']=new Set(),this['_shouldPluginsReconnect']=!0x1,this['_domEmitter']=Object['create'](_0xeda1f3);}['init'](){const _0x6ce577=this['context'],_0x229de7=_0x6ce577['plugins']['get']('CloudServices'),_0xa294d8=_0x6ce577['plugins']['get'](_0x2374c4);if(!_0x229de7['token'])throw new _0x7d2c8e('websocketgateway-missing-token',this);if(!_0x229de7['webSocketUrl'])throw new _0x7d2c8e('websocketgateway-missing-websocket-url',this);return this['_domEmitter']['listenTo'](window,'offline',()=>this['_isBrowserOffline']=!0x0),this['_domEmitter']['listenTo'](window,'online',()=>this['_isBrowserOffline']=!0x1),this['context']['config']['define']('cloudServices.connectionTimeout',0xa),this['context']['config']['define']('cloudServices.requestTimeout',0x14),c['WebSocketGateway']['connect'](_0x229de7['token'],_0x229de7['webSocketUrl'],{'timeout':0x3e8*this['context']['config']['get']('cloudServices.connectionTimeout'),'requestTimeout':0x3e8*this['context']['config']['get']('cloudServices.requestTimeout')})['then'](_0x261f1e=>{if(this['connection']=_0x261f1e,this['bind']('state')['to'](_0x261f1e,'state',this,'_isBrowserOffline',(_0x1b69be,_0x2cee7a)=>('connected'!==_0x1b69be&&(this['_shouldPluginsReconnect']=!0x0),_0x2cee7a||_0x1b69be!==_0x5ce1bc['CONNECTED']?_0x5ce1bc['DISCONNECTED']:this['state']==_0x5ce1bc['DISCONNECTED']&&this['_shouldPluginsReconnect']?(this['_shouldPluginsReconnect']=!0x1,this['_reconnect'](),_0x5ce1bc['CONNECTING']):_0x5ce1bc['CONNECTED'])),this['connection']['on']('error',(_0x4b524c,_0x45b46d)=>{if('limitExceeded'!==_0x45b46d['code'])throw console['error'](_0x45b46d),new _0x7d2c8e('cloudservices-init',null,{'originalError':_0x45b46d});_0xa294d8['showWarning']('The\x20limit\x20of\x20maximum\x20concurrent\x20connections\x20that\x20the\x20collaboration\x20server\x20can\x20handle\x20has\x20been\x20reached.\x20Try\x20opening\x20the\x20document\x20again\x20in\x20a\x20few\x20minutes.\x20Please\x20contact\x20your\x20system\x20administrator\x20if\x20the\x20problem\x20persists.',{'title':'Connected\x20users\x20limit\x20exceeded','namespace':'real-time-collaboration'});}),!_0x261f1e['me'])return new Promise(_0x27c0e6=>_0x261f1e['on']('change:me',_0x27c0e6));})['catch'](_0x54c09b=>{throw console['error'](_0x54c09b),new _0x7d2c8e('cloudservices-init',null,{'originalError':_0x54c09b});});}['addToReconnectionStack'](_0x2ee628){if('function'!=typeof _0x2ee628['reconnect'])throw new _0x7d2c8e('websocketgateway-invalid-plugin-interface',this);if(this['isInReconnectionStack'](_0x2ee628))throw new _0x7d2c8e('websocketgateway-plugin-already-registered',this,{'name':_0x2ee628['constructor']['pluginName']});this['_reconnectionStack']['add'](_0x2ee628);}['removeFromReconnectionStack'](_0x1e20ce){this['_reconnectionStack']['delete'](_0x1e20ce);}['isInReconnectionStack'](_0x48cf1d){return this['_reconnectionStack']['has'](_0x48cf1d);}['_reconnect'](){return this['connection']['reconnect']()['then'](()=>Promise['all'](Array['from'](this['_reconnectionStack'],_0x396ee5=>_0x396ee5['reconnect']())))['then'](()=>this['state']=_0x5ce1bc['CONNECTED'])['catch'](_0x1ebf81=>{throw console['error'](_0x1ebf81),new _0x7d2c8e('cloudservices-reconnection-error',this['context']);});}['destroy'](){this['connection']&&this['connection']['disconnect'](),this['state']=_0x5ce1bc['DISCONNECTED'],this['_domEmitter']['stopListening'](),super['destroy']();}}class r extends _0xcc61e9{['channelSessions'];['channelConnectedUsers'];['allConnectedUsers'];['_registeredSessions'];['_uniqueUsersCount'];['_users'];static get['pluginName'](){return'Sessions';}static get['requires'](){return[c,_0x56c9c0];}constructor(_0x218078){super(_0x218078),this['channelSessions']=new Map(),this['channelConnectedUsers']=new Map(),this['allConnectedUsers']=new _0x223e77(),this['_registeredSessions']=new Map(),this['_uniqueUsersCount']=0x0,this['_users']=this['context']['plugins']['get'](_0x56c9c0);}['init'](){const _0x42bb59=this['context']['plugins']['get'](c);this['listenTo'](_0x42bb59,'change:state',(_0x2a4313,_0x1c21e3,_0x2ae8a9)=>{if('connected'!==_0x2ae8a9)this['channelSessions']['forEach'](_0x19d10e=>_0x19d10e['clear']()),this['channelConnectedUsers']['forEach'](_0x24ca14=>_0x24ca14['clear']()),this['allConnectedUsers']['clear']();else{for(const [_0x1e6e8b,_0x2139cb]of this['_registeredSessions'])for(const _0x3c33a8 of _0x2139cb)this['_handleSessionAdd'](_0x1e6e8b,_0x3c33a8);}}),this['_createUser'](_0x42bb59['connection']['me'],!0x0);}['register'](_0x27c6df,_0x28280f){if(this['_registeredSessions']['has'](_0x27c6df))throw new _0x7d2c8e('sessions-register-already-registered',null,{'channelId':_0x27c6df});this['_registeredSessions']['set'](_0x27c6df,_0x28280f),this['channelSessions']['set'](_0x27c6df,new _0x223e77()),this['channelConnectedUsers']['set'](_0x27c6df,new _0x223e77()),this['listenTo'](_0x28280f,'add',(_0x3520b3,_0x3ba8c5)=>this['_handleSessionAdd'](_0x27c6df,_0x3ba8c5)),this['listenTo'](_0x28280f,'remove',(_0x4bb334,_0x322e2d)=>this['_handleSessionRemove'](_0x27c6df,_0x322e2d));for(const _0x4bbdb3 of _0x28280f)this['_handleSessionAdd'](_0x27c6df,_0x4bbdb3);}['unregister'](_0x168738){if(!this['_registeredSessions']['has'](_0x168738))throw new _0x7d2c8e('sessions-unregister-not-exist',null,{'channelId':_0x168738});const _0x36a12b=this['_registeredSessions']['get'](_0x168738);this['stopListening'](_0x36a12b);for(const _0x51db65 of _0x36a12b)'connected'===this['context']['plugins']['get'](c)['state']&&this['_handleSessionRemove'](_0x168738,_0x51db65);this['_registeredSessions']['delete'](_0x168738),this['channelSessions']['delete'](_0x168738),this['channelConnectedUsers']['delete'](_0x168738);}get['mySessionId'](){return this['context']['plugins']['get'](c)['connection']['sessionId'];}['getUserBySessionId'](_0x499fe3){for(const _0x85129d of this['channelSessions']['values']())for(const _0x2f97a2 of _0x85129d)if(_0x2f97a2['id']===_0x499fe3)return _0x2f97a2['user'];}['getUserSessions'](_0x3ab68c,_0xd93e67){const _0x15e87e=_0xd93e67?[this['channelSessions']['get'](_0xd93e67)]:this['channelSessions']['values'](),_0x566661=new Set();for(const _0x22dccd of _0x15e87e)for(const _0x2cc556 of _0x22dccd)_0x2cc556['user']['id']===_0x3ab68c['id']&&_0x566661['add'](_0x2cc556['id']);return _0x566661;}['getUserRole'](_0x5403d5){for(const _0x7a58e1 of this['channelSessions']['values']())for(const _0x217fea of _0x7a58e1)if(_0x217fea['user']===_0x5403d5)return _0x217fea['role'];}['_handleSessionAdd'](_0xe1b5b5,_0x1e668b){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x18a999=_0x1e668b['user'],_0x48aa9a=this['_users']['getUser'](_0x18a999['id'])||this['_createUser'](_0x18a999),_0x2a41ad=Object['assign']({},_0x1e668b,{'user':_0x48aa9a});this['channelSessions']['get'](_0xe1b5b5)['add'](_0x2a41ad);const _0x381023=this['channelConnectedUsers']['get'](_0xe1b5b5);_0x381023['has'](_0x48aa9a['id'])||_0x381023['add'](_0x48aa9a),this['allConnectedUsers']['has'](_0x48aa9a['id'])||this['allConnectedUsers']['add'](_0x48aa9a,_0x48aa9a['isMe']?0x0:void 0x0),this['fire']('sessionAdd:'+_0xe1b5b5,{'channelId':_0xe1b5b5,'session':_0x2a41ad});}['_handleSessionRemove'](_0x23b65e,_0x41a01e){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x140ac8=this['channelConnectedUsers']['get'](_0x23b65e),_0x24dca2=_0x41a01e['user'];_0x24dca2['id']&&(this['channelSessions']['get'](_0x23b65e)['remove'](_0x41a01e['id']),_0x140ac8['has'](_0x24dca2['id'])&&!this['getUserSessions'](_0x24dca2,_0x23b65e)['size']&&_0x140ac8['remove'](_0x24dca2['id']),this['allConnectedUsers']['get'](_0x24dca2['id'])&&!this['getUserSessions'](_0x24dca2)['size']&&this['allConnectedUsers']['remove'](_0x24dca2['id']));}['_createUser'](_0x3eb7b9,_0x240f10){const _0x1d14b5=this['_users']['addUser'](_0x3eb7b9);return _0x240f10&&this['_users']['defineMe'](_0x3eb7b9['id']),_0x1d14b5['orderNumber']=this['_uniqueUsersCount']++,_0x1d14b5;}}class H extends _0x24fdff{['_domEmitter']=new(_0xeda1f3())();static get['requires'](){return[r];}static get['pluginName'](){return'UserMarkers';}['init'](){const _0x171873=this['editor'],_0x4a4b96=_0x171873['plugins']['get'](r);_0x171873['conversion']['for']('editingDowncast')['markerToElement']({'model':'user:position','view':(_0x2d3849,{writer:_0x10dcb3})=>function(_0x14f1fc,_0x27a3c1,_0x3204e2,_0x547b5f){const _0x5cd4c1=_0x14f1fc['markerName']['split'](':')[0x2],_0x463d53=_0x3204e2['getUserBySessionId'](_0x5cd4c1);if(!_0x463d53||_0x5cd4c1===_0x3204e2['mySessionId'])return;if(!_0x547b5f['model']['schema']['checkChild'](_0x14f1fc['markerRange']['start'],'$text'))return;const _0x3e5e35={'class':'ck-user__marker\x20'+_0x463d53['color']['getMarkerClass'](),'data-name':_0x463d53['name'],'data-session-id':_0x5cd4c1},_0x38a63b=_0x547b5f['model']['markers']['get'](_0x14f1fc['markerName']),_0x1f19c9=_0x38a63b['getStart'](),_0x367bac=_0x1f19c9['nodeAfter'],_0x210659=_0x547b5f['model']['schema'];if(_0x367bac&&_0x210659['isObject'](_0x367bac)&&_0x210659['isInline'](_0x367bac)&&!_0x547b5f['model']['markers']['get']('user:range:'+_0x5cd4c1)['getRange']()['isCollapsed'])return;const _0x1b0bb9=_0x1f19c9['parent'];return _0x547b5f['model']['schema']['isLimit'](_0x1b0bb9)&&!_0x547b5f['model']['hasContent'](_0x1b0bb9)&&(_0x3e5e35['contenteditable']=!0x1),function(_0x2f0189,_0x117b97,_0x1af1cd){const _0x579600=_0x2f0189['createUIElement']('span',_0x117b97);return _0x2f0189['setCustomProperty']('userPositionMarker',!0x0,_0x579600),_0x579600['render']=function(_0xe71720){const _0x24f535=this['toDomElement'](_0xe71720);return _0x24f535['innerHTML']='⁠<span\x20class=\x22ck-user__marker-line\x22\x20contenteditable=\x22false\x22><span\x20class=\x22ck-user__marker-dot\x22></span></span><span\x20class=\x22ck-user__marker-tooltip\x22\x20contenteditable=\x22false\x22\x20spellcheck=\x22false\x22>'+_0x1af1cd['name']+'</span>⁠',_0x24f535['addEventListener']('mouseenter',()=>{_0x24f535['classList']['add']('ck-user__marker_hovered');}),_0x24f535['addEventListener']('mouseleave',()=>{_0x24f535['classList']['remove']('ck-user__marker_hovered');}),_0x24f535;},_0x579600['isSimilar']=function(_0x22a146){return!(!this['getCustomProperty']('userPositionMarker')||!_0x22a146['getCustomProperty']('userPositionMarker')||this['getAttribute']('data-session-id')!=_0x22a146['getAttribute']('data-session-id'));},_0x579600;}(_0x27a3c1,_0x3e5e35,_0x463d53);}(_0x2d3849,_0x10dcb3,_0x4a4b96,_0x171873)}),_0x171873['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'user:range','view':_0x53cd7b=>function(_0x4b2376,_0x3859b0){const _0x1e7687=_0x4b2376['markerName']['split'](':')[0x2];if(_0x1e7687===_0x3859b0['mySessionId'])return null;const _0x279115=_0x3859b0['getUserBySessionId'](_0x1e7687);if(!_0x279115)return{'id':_0x1e7687,'classes':[]};return{'id':_0x1e7687,'classes':['ck-user__selection',_0x279115['color']['getSelectionClass']()],'attributes':{'data-session-id':_0x1e7687},'priority':0x7d0+_0x279115['orderNumber']};}(_0x53cd7b,_0x4a4b96)}),function(_0x4e74a4){const _0x272d71=_0x4e74a4['model'],_0x13e55f=new Map(),_0x504ca1=_0x4e74a4['plugins']['get'](r);_0x272d71['markers']['on']('update:user:range',(_0x46ff99,_0x358454,_0x19b925,_0x1a192e)=>{if(!_0x1a192e&&_0x13e55f['get'](_0x358454['name']))return _0x13e55f['get'](_0x358454['name'])['detach'](),void _0x13e55f['delete'](_0x358454['name']);const _0x2cc44f=_0x358454['name']['split'](':')[0x2];if(_0x2cc44f===_0x504ca1['mySessionId'])return;const _0x160582='user:position:'+_0x2cc44f;_0x272d71['markers']['has'](_0x160582)&&_0x4e74a4['editing']['reconvertMarker'](_0x160582),_0x358454['on']('change:range',(_0x538a17,_0x531485,_0x4e134b)=>{if('$graveyard'!=_0x531485['root']['rootName']&&'$graveyard'==_0x358454['getRange']()['root']['rootName']&&!_0x13e55f['has'](_0x358454['name'])){const _0x5781a5=_0x272d71['schema']['getNearestSelectionRange'](_0x4e134b['deletionPosition']);if(_0x5781a5){const _0x4837f6=ht['fromRange'](_0x5781a5);_0x13e55f['set'](_0x358454['name'],_0x4837f6),_0x4837f6['on']('change:range',(_0x19e452,_0x4ce5eb,_0x45462f)=>{if('$graveyard'==_0x4837f6['root']['rootName']){const _0x4c0fc4=_0x272d71['schema']['getNearestSelectionRange'](_0x45462f['deletionPosition']);_0x4c0fc4?(_0x4837f6['start']=_0x4c0fc4['start'],_0x4837f6['end']=_0x4c0fc4['end']):(_0x13e55f['delete'](_0x358454['name']),_0x4837f6['detach']());}});}}});}),_0x272d71['document']['on']('change',()=>{_0x13e55f['size']>0x0&&_0x272d71['enqueueChange']({'isUndoable':!0x1},_0x3489c3=>{for(const [_0x36fb8e,_0x38c9d0]of _0x13e55f)'$graveyard'==_0x272d71['markers']['get'](_0x36fb8e)['getRange']()['root']['rootName']&&(re(_0x36fb8e['split'](':')[0x2],_0x38c9d0['toRange'](),_0x272d71,_0x3489c3),_0x38c9d0['detach']());_0x13e55f['clear']();});});}(_0x171873),this['_domEmitter']['listenTo'](_0x51c3dd['document'],'keydown',(_0x362f71,{key:_0x13b439})=>{'Escape'===_0x13b439&&function(_0x23c1f4){_0x23c1f4['editing']['view']['change'](_0x23a5d3=>{for(const _0x28992e of _0x23c1f4['model']['markers']){if(!_0x28992e['name']['startsWith']('user:position'))continue;const _0x3e2b66=_0x23c1f4['editing']['mapper']['markerNameToElements'](_0x28992e['name']);if(_0x3e2b66){for(const _0x1dc037 of _0x3e2b66)_0x23a5d3['removeClass']('ck-user__marker_hovered',_0x1dc037);}}});}(_0x171873);},{'useCapture':!0x0});}['afterInit'](){const _0x4cc1fa=this['editor'],_0x4765e0=_0x4cc1fa['commands']['get']('undo');_0x4765e0&&_0x4cc1fa['model']['on']('applyOperation',(_0x2ee1a6,_0x4a125f)=>{const _0x453023=_0x4a125f[0x0];if('marker'!=_0x453023['type']||!_0x453023['name']['startsWith']('user:'))return;const _0x283df9=_0x453023['batch'];_0x4765e0['_createdBatches']['has'](_0x283df9)&&(_0x453023['newRange']=_0x453023['oldRange']?_0x4cc1fa['model']['createRange'](_0x453023['oldRange']['start'],_0x453023['oldRange']['end']):null);},{'priority':'highest'});}['destroy'](){return this['_domEmitter']['stopListening'](),super['destroy']();}['createUserMarkerOperations'](){const _0x3f68ef=this['editor'],_0x35f217=_0x3f68ef['model']['document'],_0x4b6880=_0x3f68ef['plugins']['get'](r);_0x3f68ef['model']['enqueueChange']({'isUndoable':!0x1},_0xbabb2c=>{const _0x415aaa='user:range:'+_0x4b6880['mySessionId'],_0x1d1fb4='user:position:'+_0x4b6880['mySessionId'],_0x62bac0=_0x3f68ef['model']['markers']['has'](_0x415aaa);_0x3f68ef['editing']['view']['hasDomSelection']?re(_0x4b6880['mySessionId'],_0x35f217['selection']['getFirstRange'](),_0x3f68ef['model'],_0xbabb2c):_0x62bac0&&(_0xbabb2c['removeMarker'](_0x415aaa),_0xbabb2c['removeMarker'](_0x1d1fb4));});}}function re(_0x51098d,_0x20b89b,_0xbec841,_0x492169){const _0x15adac='user:range:'+_0x51098d,_0x27be68='user:position:'+_0x51098d,_0x3af41c=_0x20b89b['getContainedElement']();let _0x3f2798=_0x20b89b['start'];_0x3af41c&&_0x3af41c['is']('element','tableCell')&&(_0x3f2798=function(_0x239980,_0x6553e5){for(const _0x37199f of _0x239980['getPositions']())if(_0x6553e5['schema']['checkChild'](_0x37199f,'$text'))return _0x37199f;}(_0x20b89b,_0xbec841),_0x20b89b=_0x492169['createRange'](_0x3f2798));const _0x1306c6=_0x492169['createRange'](_0x3f2798);_0xbec841['markers']['has'](_0x15adac)?(_0x492169['updateMarker'](_0x15adac,{'range':_0x20b89b}),_0x492169['updateMarker'](_0x27be68,{'range':_0x1306c6})):(_0x492169['addMarker'](_0x15adac,{'range':_0x20b89b,'usingOperation':!0x0}),_0x492169['addMarker'](_0x27be68,{'range':_0x1306c6,'usingOperation':!0x0}));}function q(_0x2685a0,_0x5d24a9,_0x430a74){const t=_0x2685a0['t'];switch(_0x5d24a9){case'PENDING_ACTION_SENDING_DATA':return t({'string':'Sending\x20data\x20to\x20the\x20server.','id':'PENDING_ACTION_SENDING_DATA'});case'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'Synchronization\x20issue':return t('Synchronization\x20issue');case'PENDING_ACTION_REVISION_HISTORY':return t({'string':'Unsaved\x20change\x20in\x20revision\x20history.','id':'PENDING_ACTION_REVISION_HISTORY'});case'CONNECTED_USERS':return t({'string':'1\x20connected\x20user\x20(me)','plural':'%0\x20connected\x20users','id':'CONNECTED_USERS'},_0x430a74);default:return'';}}let K=0x1;class l extends _0x24fdff{static ['CollaborativeEditingService']=/* #__PURE__ -- @preserve */
((()=>_0x4b38a7)());['_offset'];['sessionId'];['serverHistory'];['_channelId'];['_service'];['_document'];['_compressor'];['_bufferedOperations'];['_knownOperations'];['_knownRootNames'];['_pendingAction'];['_hasSelectionChanged'];['_sendBufferedOperationsDelayId'];['_baseBufferDelay'];['_currentBufferDelay'];['_lastSyncedOperationId'];['_disconnectionOperations'];['_operationIdentifier'];static get['requires'](){return[c,r,H,_0x2a390c,_0x56c9c0,_0x2374c4];}static get['pluginName'](){return'RealTimeCollaborationClient';}get['cloudDocumentVersion'](){return this['_lastServerVersion']+this['_offset'];}get['_lastServerVersion'](){return this['serverHistory']['version']-this['_offset'];}get['lastSyncVersion'](){const _0x2d79f4=this['serverHistory']['getOperations']();for(let _0x4b9b86=_0x2d79f4['length']-0x1;_0x4b9b86>=0x0;_0x4b9b86--){const _0x30d0e8=_0x2d79f4[_0x4b9b86];if(!this['_disconnectionOperations']['has'](_0x30d0e8))return _0x30d0e8['baseVersion']+0x1-this['_offset'];}return 0x0;}constructor(_0x3545bd){if(super(_0x3545bd),this['_offset']=0x0,this['sessionId']=null,this['serverHistory']=new _0x33cb73(),this['editor']['config']['define']('collaboration',{}),this['_channelId']=this['editor']['config']['get']('collaboration.channelId'),!this['_channelId'])throw new _0x7d2c8e('collaboration-missing-channelid',this);const _0x21b768=_0x3545bd['config']['get']('cloudServices.bundleVersion')||nt;this['_service']=new l['CollaborativeEditingService'](_0x21b768,this['_channelId']),this['_document']=this['editor']['model']['document'],this['_compressor']=new _0x265e28(),this['_bufferedOperations']=[],this['_knownOperations']=new WeakSet(),this['_knownRootNames']=new Set(),this['set']('_isPendingUpdate',!0x1),this['set']('_hasSynchronizationProblem',!0x1),this['_pendingAction']=null,this['_hasSelectionChanged']=!0x1,this['_sendBufferedOperationsDelayId']=null,this['_baseBufferDelay']=0x12c,this['_currentBufferDelay']=this['_baseBufferDelay'],this['_lastSyncedOperationId']=null,this['_disconnectionOperations']=new WeakSet(),this['_operationIdentifier']=new X(this['_disconnectionOperations']);}['init'](){const _0x367416=this['editor'],_0x132ba7=_0x367416['plugins']['get'](_0x56c9c0),_0x1ff9ea=_0x367416['plugins']['get'](c);this['listenTo'](_0x132ba7,'getOperationAuthor',(_0x527a66,_0x595aab)=>{const _0x79f1fc=_0x595aab[0x0];_0x79f1fc['_authorId']&&(_0x527a66['return']=_0x132ba7['getUser'](_0x79f1fc['_authorId']),_0x527a66['stop']()),null===_0x79f1fc['_authorId']&&(_0x527a66['return']=null,_0x527a66['stop']());},{'priority':'high'}),this['listenTo'](_0x367416['model']['document']['selection'],'change:range',(_0x7e0e1,_0x11d1df)=>{_0x11d1df['directChange']&&this['_refreshUserSelectionMarkers']();}),this['listenTo'](_0x367416['editing']['view'],'change:hasDomSelection',()=>{this['_refreshUserSelectionMarkers']();}),this['_initThrowingOnDataSet'](),_0x367416['model']['on']('applyOperation',(_0x5b1f9c,_0x2bc90e)=>{const _0x469227=_0x2bc90e[0x0];_0x469227['isDocumentOperation']&&(this['_saveOperationInBuffer'](_0x469227),this['_shouldSendUpdate']()&&this['_sendBufferedOperationsDelayed']());}),this['_setUpDataInit'](),this['bind']('_isEditingAllowed')['to'](_0x1ff9ea,'state',this,'_hasSynchronizationProblem',(_0x1ce7a9,_0x48d320)=>'connected'===_0x1ce7a9&&!_0x48d320),this['on']('change:_isEditingAllowed',()=>{this['_isEditingAllowed']?_0x367416['disableReadOnlyMode']('rtc-offline'):_0x367416['enableReadOnlyMode']('rtc-offline');}),this['_isEditingAllowed']?_0x367416['disableReadOnlyMode']('rtc-offline'):_0x367416['enableReadOnlyMode']('rtc-offline'),this['set']('_isConnected',!0x1);}async['reconnect'](){const _0x3e6965=this['editor']['plugins']['get'](r),_0x52d6d0=this['editor']['plugins']['get'](c);try{this['_isPendingUpdate']=!0x0,_0x3e6965['unregister'](this['_channelId']);const _0x5dcecf=await this['_service']['reconnect'](_0x52d6d0['connection'],this['lastSyncVersion']);await this['_handleReconnectionResponse'](_0x5dcecf)&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());const _0x3d2cf1=await this['_service']['getConnectedSessions']();_0x3e6965['register'](this['_channelId'],_0x3d2cf1),this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}catch(_0x4c33a4){if(function(_0x5cfc53){return'404'===_0x5cfc53['code'];}(_0x4c33a4)&&this['sessionId'])await this['_connectAfterSessionHasBeenFlushed']();else{if(function(_0x376396){return'409'===_0x376396['code'];}(_0x4c33a4)){const _0x596cd1=q(this['editor']['locale'],'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x596cd1);}else{if(!(_0x4c33a4 instanceof J))throw _0x4c33a4;this['_handleReconnectionError']();}}}}['destroy'](){const _0x16350b=this['editor']['plugins']['get'](c),_0x33d70d=this['editor']['plugins']['get'](r);this['editor']['enableReadOnlyMode']('rtc-destroyed'),_0x33d70d['channelSessions']['has'](this['_channelId'])&&_0x33d70d['unregister'](this['_channelId']),_0x16350b['removeFromReconnectionStack'](this),this['_disconnectService'](),super['destroy']();}async['_handleReconnectionResponse'](_0x32ffdc){if(this['sessionId']!==_0x32ffdc['sessionId']&&this['_lastSyncedOperationId']!==_0x32ffdc['lastOperationId'])throw new J();return this['sessionId']=_0x32ffdc['sessionId'],this['_handleServerResponse']([],{..._0x32ffdc,'wereChangesApplied':!0x1,'data':_0x32ffdc['data']},'reconnect');}async['_connectService'](_0xbc961e,_0x405257=!0x1){const {connection:_0x450da9}=this['editor']['plugins']['get'](c);l['CollaborativeEditingService']['getConnectedSessions'](_0x450da9,this['_channelId'])['then'](_0x51aa28=>this['_initSessionsHandling'](_0x51aa28))['catch'](_0x33ff3d=>{this['_crash']('realtimecollaborationclient-init-session-connection-error',_0x33ff3d);}),this['listenTo'](this['_service'],'operationsReceived',this['_handleReceivedOperations']['bind'](this)),this['listenTo'](this['_service'],'error',(_0x14a2c0,_0x2becbc)=>{this['_crash']('realtimecollaborationclient-initservice-internal-error',_0x2becbc);}),this['listenTo'](this['_service'],'disconnected',()=>{this['_isConnected']=!0x1;});const _0x40a6d4=this['_operationIdentifier']['getIdOfTheLastOperation'](_0xbc961e);this['_isPendingUpdate']=!0x0;const _0x4bdbfe=await this['_service']['connect'](_0x450da9,this['_compressOperations'](_0xbc961e),_0x40a6d4);if(this['sessionId']=_0x4bdbfe['sessionId'],_0x405257){if(!_0x4bdbfe['wereChangesApplied'])return void this['_handleReconnectionError']();this['_isPendingUpdate']=!0x1,this['_clearPendingAction'](),this['serverHistory']['reset'](),this['_offset']=_0x4bdbfe['offset'],this['serverHistory']['version']=this['_offset'],await this['_handleServerResponse'](_0xbc961e,_0x4bdbfe,'reconnection:\x20flushed\x20session');}else await this['_handleInitialConnectionData'](_0x4bdbfe,_0xbc961e);this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}['_handleSendingSelectionMarkers'](){const _0x3e3ce3=this['editor']['plugins']['get'](r),_0x2260f1=this['editor']['plugins']['get'](H),_0xf0632e=_0x3e3ce3['channelSessions']['get'](this['_channelId']);_0xf0632e&&_0xf0632e['length']>0x1?_0x2260f1['createUserMarkerOperations']():this['listenTo'](_0x3e3ce3,'sessionAdd:'+this['_channelId'],()=>{0x2===_0x3e3ce3['channelSessions']['get'](this['_channelId'])['length']&&_0x2260f1['createUserMarkerOperations']();});}async['_handleReceivedOperations'](_0x5ebaa7,_0x2f4187,_0x101cda,_0x42c3a6){if(!this['_isPendingUpdate']&&this['_document']['version']==_0x2f4187){const _0x2390a6=this['_decompressOperations'](_0x101cda,_0x42c3a6);await this['_fetchMissingUsers'](_0x2390a6),this['_handleExternalOperations'](_0x2390a6,_0x2f4187,_0x101cda['lastOperationId'])||this['_crash']('realtimecollaborationclient-initservice-incorrect-server-operation');}}async['_connectAfterSessionHasBeenFlushed'](){this['_disconnectService']();const {locale:_0x4d8d8f}=this['editor'];let _0x9262b;try{_0x9262b=await this['_service']['getDocumentDetails']();}catch(_0x1cd303){const _0x4403cf=q(_0x4d8d8f,'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');return void this['_handleReconnectionError'](_0x4403cf);}const _0x3697b7=_0x9262b['currentDocumentSession']||_0x9262b['lastDocumentSession'];if(this['_lastSyncedOperationId']===_0x3697b7['lastOperationId'])await this['_connectService'](this['editor']['model']['document']['history']['getOperations'](),!0x0);else{const _0x1faead=q(_0x4d8d8f,'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x1faead);}}['_disconnectService'](){this['_service']['disconnect'](),this['_bufferedOperations']=[],clearTimeout(this['_sendBufferedOperationsDelayId']),this['stopListening'](this['_service']);}['_initSessionsHandling'](_0x283004){const _0x588ff8=this['editor']['plugins']['get'](r);this['listenTo'](_0x588ff8,'sessionAdd:'+this['_channelId'],(_0x599d43,{session:_0x5dcf5b})=>{if(_0x5dcf5b['id']===_0x588ff8['mySessionId']){_0x599d43['off']();const _0x265079=this['editor']['plugins']['has']('CommentsOnly')&&this['editor']['plugins']['get']('CommentsOnly');let _0x138288=_0x5dcf5b['permissions'];_0x265079&&_0x265079['isEnabled']&&(_0x138288=_0x138288['filter'](_0x3ba1f8=>'document:write'!==_0x3ba1f8)),this['editor']['plugins']['get']('Permissions')['setPermissions'](_0x138288,this['_channelId']);}}),_0x588ff8['register'](this['_channelId'],_0x283004);}['_initThrowingOnDataSet'](){const _0x322959=this['editor']['data']['set'];this['editor']['data']['set']=(..._0x52de73)=>{if(!_0x52de73[_0x52de73['length']-0x1]['suppressErrorInCollaboration'])throw new _0x7d2c8e('realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration',this);_0x322959['apply'](this['editor']['data'],_0x52de73);};}['_setUpDataInit'](){this['editor']['data']['on']('init',(_0x325ecd,[_0x5dc01b])=>{if(this['_document']['version'])throw new _0x7d2c8e('realtimecollaborationclient-init-document-already-initialized',this);_0x325ecd['stop'](),this['_setPendingAction']();const _0x4534bf=this['editor']['config']['get']('rootsAttributes'),_0x2effa4=this['_getOperationsFromInitData'](_0x5dc01b,_0x4534bf);0x0==_0x2effa4['length']&&_0x2effa4['push'](new _0x1ae3f4(0x0)),_0x325ecd['return']=this['_connectService'](_0x2effa4)['then'](()=>{this['editor']['plugins']['get'](c)['addToReconnectionStack'](this),this['editor']['data']['fire']('ready');})['catch'](_0x15d46d=>this['_crash']('realtimecollaborationclient-init-connection-failed',_0x15d46d))['finally'](()=>this['_clearPendingAction']());},{'priority':'high'}),this['editor']['on']('loadRoot',async(_0x2dfd88,[_0xdeb6f2,_0x308889])=>{_0x2dfd88['stop']();const _0x23871f=this['editor']['model']['document']['getRoot'](_0xdeb6f2);if(!this['_knownRootNames']['has'](_0xdeb6f2)){const _0xae8089=_0x308889&&_0x308889['data']?_0x308889['data']:'',_0x5cda76=_0x308889&&_0x308889['attributes']?_0x308889['attributes']:{};await this['_loadRoot'](_0xdeb6f2,_0xae8089,_0x5cda76);}this['editor']['model']['enqueueChange']({'isUndoable':!0x1},()=>{_0x23871f['_isLoaded']=!0x0,this['editor']['model']['document']['differ']['_bufferRootLoad'](_0x23871f);});},{'priority':'high'});}async['_fetchMissingUsers'](_0x13a93a){const _0xae9c01=this['editor']['plugins']['get'](_0x56c9c0),{connection:_0x2b7623}=this['editor']['plugins']['get'](c),_0x5f0b79=new Set();for(const _0x435758 of _0x13a93a){const _0x36e38d=_0x435758['_authorId'];_0x36e38d&&!_0xae9c01['getUser'](_0x36e38d)&&_0x5f0b79['add'](_0x36e38d);}if(0x0===_0x5f0b79['size'])return;const _0x325a8d=await dt['getMany'](_0x2b7623,Array['from'](_0x5f0b79));for(const _0x2f40b2 of _0x325a8d)_0xae9c01['getUser'](_0x2f40b2['id'])||_0xae9c01['addUser'](_0x2f40b2);}['_getOperationsFromInitData'](_0x4e8053,_0x29f024={}){const _0xb16807=this['editor']['model'],_0x3f1014=[];let _0x4d0e28=0x0;const _0x5e6d4='string'==typeof _0x4e8053?{'main':_0x4e8053}:_0x4e8053;for(const _0x1c750a of Object['keys'](_0x5e6d4)){if(!this['_document']['roots']['has'](_0x1c750a))throw new _0x7d2c8e('realtimecollaborationclient-init-non-existent-root',this);const _0x3ca18f=this['editor']['data']['parse'](_0x5e6d4[_0x1c750a]),_0x3a2fd5=this['_document']['getRoot'](_0x1c750a),_0xbc454e=new _0xd54622(_0xb16807['createPositionAt'](_0x3a2fd5,0x0),_0x3ca18f,_0x4d0e28++);_0x3f1014['push'](_0xbc454e);for(const [_0x149834,_0x303095]of _0x3ca18f['markers']){const _0x1a8ded=_0xb16807['createRange'](_0xb16807['createPositionFromPath'](_0x3a2fd5,_0x303095['start']['path']['slice']()),_0xb16807['createPositionFromPath'](_0x3a2fd5,_0x303095['end']['path']['slice']())),_0x15aeff=new _0x344765(_0x149834,null,_0x1a8ded,_0xb16807['markers'],!0x0,_0x4d0e28++);_0x3f1014['push'](_0x15aeff);}}if(_0x29f024)for(const [_0x220993,_0x3adc81]of Object['entries'](_0x29f024)){const _0x329fff=_0xb16807['document']['getRoot'](_0x220993);if(!_0x329fff)throw new _0x7d2c8e('multi-root-editor-root-attributes-no-root',null);for(const [_0x427433,_0x64faaf]of Object['entries'](_0x3adc81))if(null!==_0x64faaf){const _0x362916=new _0xb0d04f(_0x329fff,_0x427433,null,_0x64faaf,_0x4d0e28++);_0x3f1014['push'](_0x362916);}}return _0x3f1014;}async['_loadRoot'](_0x73447b,_0x203146,_0x1b3f92){this['_getOperationsFromInitData']({[_0x73447b]:_0x203146},{[_0x73447b]:_0x1b3f92})['forEach']((_0x3ceb7b,_0x19ac39)=>{_0x3ceb7b['baseVersion']=this['_document']['version']+_0x19ac39,_0x3ceb7b['_isInit']=!0x0,this['_saveOperationInBuffer'](_0x3ceb7b);}),this['_sendBufferedOperationsDelayed'](),await this['_waitUntilSynced']();}async['_handleInitialConnectionData'](_0x38fafe,_0x314817){let _0x28d1a8;this['_offset']=_0x38fafe['offset'];const _0x208d4e=_0x38fafe['wereChangesApplied']&&!_0x38fafe['initData'],_0x5da6f6=_0x208d4e?0x0:_0x38fafe['data']['baseVersion'];if(_0x314817['forEach'](_0x4ad921=>{_0x4ad921['_isInit']=!0x0,_0x4ad921['createdAt']=_0x38fafe['sessionCreatedAt'],_0x4ad921['_authorId']=null;}),_0x208d4e)_0x28d1a8=_0x314817,this['_applyOperationsSet'](_0x28d1a8,_0x208d4e);else{if(_0x38fafe['initData']){const _0x3e4023=this['_getOperationsFromInitData'](_0x38fafe['initData']);this['_document']['history']['version']=-_0x3e4023['length'],_0x3e4023['forEach'](_0x224c06=>{_0x224c06['baseVersion']-=_0x3e4023['length'],_0x224c06['createdAt']=_0x38fafe['sessionCreatedAt'],_0x224c06['_isInit']=!0x0,_0x224c06['_authorId']=null;}),this['_applyOperationsSet'](_0x3e4023,!0x0),this['serverHistory']['version']=-_0x3e4023['length']+this['_offset'],this['_updateServerHistory'](_0x3e4023);}this['_document']['history']['version']=_0x5da6f6,_0x28d1a8=this['_decompressOperations'](_0x38fafe['data'],_0x38fafe['metadata']),await this['_fetchMissingUsers'](_0x28d1a8),this['_applyOperationsSet'](_0x28d1a8,_0x208d4e);}_0x38fafe['lastOperationId']&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x28d1a8,_0x38fafe['lastOperationId']),this['_lastSyncedOperationId']=_0x38fafe['lastOperationId']),this['serverHistory']['version']=_0x5da6f6+this['_offset'],this['_updateServerHistory'](_0x28d1a8),_0x314817['filter'](_0x58e7f6=>{const _0x450fad=this['_getAffectedRoot'](_0x58e7f6);return _0x450fad&&!this['_knownRootNames']['has'](_0x450fad);})['forEach']((_0x5eeed8,_0x4c5d88)=>{_0x5eeed8['baseVersion']=this['_document']['version']+_0x4c5d88,this['_saveOperationInBuffer'](_0x5eeed8);}),this['_shouldSendUpdate']()?(this['_currentBufferDelay']=0x0,this['_sendBufferedOperationsDelayed'](!0x0),await this['_waitUntilSynced']()):(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());}['_crash'](_0x35fffc,_0xeda4e6){throw this['_isPendingUpdate']=!0x0,_0xeda4e6&&console['error'](_0xeda4e6),new _0x7d2c8e(_0x35fffc,this['editor']);}['_saveOperationInBuffer'](_0x34b4fc){this['_knownOperations']['has'](_0x34b4fc)||(this['_knownOperations']['add'](_0x34b4fc),this['_bufferedOperations']['push'](_0x34b4fc),this['_pendingAction']||'marker'==_0x34b4fc['type']&&!_0x34b4fc['affectsData']||this['_setPendingAction']());}['_sendBufferedOperationsDelayed'](_0x4b1cee=!0x1){!_0x4b1cee&&this['_isPendingUpdate']||(this['_isPendingUpdate']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_sendBufferedOperationsDelayId']=setTimeout(()=>{this['_sendBufferedOperations']()['then'](_0x449f63=>{_0x449f63&&(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1);})['catch'](_0x85d4b9=>{if(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1,!function(_0x1eee1b){return _0x1eee1b['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x1eee1b['message']['startsWith']('cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.')||_0x1eee1b['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}(_0x85d4b9))throw _0x85d4b9;});},this['_currentBufferDelay']));}['_waitUntilSynced'](){return new Promise(_0x5d5578=>{this['on']('change:_isPendingUpdate',()=>{_0x5d5578();});});}async['_sendBufferedOperations'](){const _0x257e79=this['editor']['plugins']['get'](H);if(this['_shouldSendSelectionUpdate']()&&(_0x257e79['createUserMarkerOperations'](),this['_hasSelectionChanged']=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0x591119=[...this['_bufferedOperations']];for(const _0x350a92 of _0x591119)_0x350a92['wasUndone']=this['_document']['history']['isUndoneOperation'](_0x350a92);const _0x43bf70=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x591119),_0x16ab74=K++,_0x3b7fb2=this['_compressOperations'](_0x591119),_0x3a6c04=await this['_service']['sendOperations'](_0x3b7fb2,_0x3b7fb2['baseVersion'],_0x43bf70);try{return await this['_handleServerResponse'](_0x591119,_0x3a6c04,_0x16ab74);}catch(_0x2ed26e){return this['_crash']('realtimecollaborationclient-sendbufferedoperations',_0x2ed26e);}}async['_handleServerResponse'](_0x47444b,_0x5b7fe2,_0x3cb96a){if('error'in _0x5b7fe2)throw _0x5b7fe2['error'];let _0x6e64ec=!0x1;if(_0x5b7fe2['wereChangesApplied']){_0x5b7fe2['lastOperationId']&&(this['_lastSyncedOperationId']=_0x5b7fe2['lastOperationId']),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x31d439=>!_0x47444b['includes'](_0x31d439));for(const _0x9c8868 of _0x47444b)_0x9c8868['createdAt']='lastOperationAcceptedAt'in _0x5b7fe2&&_0x5b7fe2['lastOperationAcceptedAt']||void 0x0;Q(_0x47444b,_0x5b7fe2['version']-_0x47444b['length']),this['_updateServerHistory'](_0x47444b);const _0x2c35a5=_0x47444b['filter'](_0x445f00=>{if(!_0x445f00['_isInit'])return!0x1;const _0xf65542=this['_getAffectedRoot'](_0x445f00);return _0xf65542&&!this['_knownRootNames']['has'](_0xf65542);});Q(_0x2c35a5,this['_document']['version']),this['_applyOperationsSet'](_0x2c35a5),_0x6e64ec=!0x0,this['_currentBufferDelay']=this['_baseBufferDelay'];}else{const _0x49077d=this['_decompressOperations'](_0x5b7fe2['data'],_0x5b7fe2['metadata'])['filter'](_0x12ffdb=>_0x12ffdb['baseVersion']>=this['_lastServerVersion']);_0x49077d['forEach'](_0x3751c2=>this['_addKnownRoot'](_0x3751c2)),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x3846e6=>!_0x3846e6['_isInit']||!this['_knownRootNames']['has'](this['_getAffectedRoot'](_0x3846e6))),this['_bufferedOperations']['length']&&Q(this['_bufferedOperations'],this['_bufferedOperations'][0x0]['baseVersion']),await this['_fetchMissingUsers'](_0x49077d),_0x6e64ec=this['_handleExternalOperations'](_0x49077d,_0x5b7fe2['version'],_0x5b7fe2['lastOperationId']),this['_currentBufferDelay']=Math['round'](this['_currentBufferDelay']/0x2);}return _0x6e64ec?!this['_shouldSendUpdate']()||(this['_sendBufferedOperationsDelayed'](!0x0),!0x1):this['_crash']('realtimecollaborationclient-handleserverresponse');}['_handleExternalOperations'](_0x4cd5d0,_0x30a6c1,_0x1fd4a9){try{const _0x5b1a8e={'document':this['_document'],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0x5f2af1,operationsB:_0x1e87ce,originalOperations:_0x4f95fd}=_0x2b4463(_0x4cd5d0,this['_bufferedOperations'],_0x5b1a8e);Q(_0x5f2af1,this['_document']['version']),Q(_0x1e87ce,_0x30a6c1);for(const _0x45c70b of _0x5f2af1){const _0x541daa=_0x4f95fd['get'](_0x45c70b);_0x45c70b['_authorId']=_0x541daa?_0x541daa['_authorId']:null;}_0x1fd4a9&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x4cd5d0,_0x1fd4a9),this['_lastSyncedOperationId']=_0x1fd4a9),this['_bufferedOperations']=[..._0x1e87ce],this['_applyOperationsSet'](_0x5f2af1),this['_updateServerHistory'](_0x4cd5d0);}catch(_0x213837){return console['error'](_0x213837),!0x1;}return!0x0;}['_applyOperationsSet'](_0x2d3f63,_0x107875=!0x1){this['editor']['model']['enqueueChange']({'isUndoable':!0x1,'isLocal':!0x1},_0x22f42b=>{for(const _0x196157 of _0x2d3f63)this['_knownOperations']['add'](_0x196157),this['_addKnownRoot'](_0x196157),_0x22f42b['batch']['addOperation'](_0x196157),this['editor']['model']['applyOperation'](_0x196157);});}['_addKnownRoot'](_0x1d18ef){const _0x2136ae=this['_getAffectedRoot'](_0x1d18ef);_0x2136ae&&this['_knownRootNames']['add'](_0x2136ae);}['_getAffectedRoot'](_0x160622){let _0x114750,_0x5cff99;switch(_0x160622['type']){case'insert':_0x114750=_0x160622['position']['root'];break;case'marker':if(_0x5cff99=_0x160622['newRange'],!_0x5cff99)return null;_0x114750=_0x5cff99['root'];break;case'addRootAttribute':_0x114750=_0x160622['root'];break;case'addRoot':_0x114750=_0x160622['affectedSelectable'];break;case'move':_0x114750=_0x160622['targetPosition']['root'];break;default:return null;}return _0x114750['rootName'];}['_updateServerHistory'](_0x3d7c61){_0x3d7c61['forEach'](_0x355c5b=>{const _0x4b6c7a=_0x355c5b['clone']();_0x4b6c7a['_authorId']=_0x355c5b['_authorId'],_0x4b6c7a['_isInit']=!!_0x355c5b['_isInit'],_0x4b6c7a['createdAt']=_0x355c5b['createdAt'],_0x4b6c7a['baseVersion']+=this['_offset'],_0x355c5b['_isDisconnection']&&this['_disconnectionOperations']['add'](_0x4b6c7a),this['serverHistory']['addOperation'](_0x4b6c7a);});}['_handleReconnectionError'](_0x2e13ea){const _0x1879cf=this['editor']['plugins']['get']('Notification'),_0x318d0e=this['editor']['locale'];_0x2e13ea||(_0x2e13ea=q(_0x318d0e,'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.')),_0x1879cf['showWarning'](_0x2e13ea,{'title':q(_0x318d0e,'Synchronization\x20issue'),'namespace':'real-time-collaboration'}),this['_hasSynchronizationProblem']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_bufferedOperations']=[],this['editor']['plugins']['get'](c)['destroy']();}['_setPendingAction'](){this['_pendingAction']||(this['_pendingAction']=this['editor']['plugins']['get'](_0x2a390c)['add'](q(this['editor']['locale'],'PENDING_ACTION_SENDING_DATA')));}['_clearPendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get'](_0x2a390c)['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_compressOperations'](_0x7223bd){const _0x54ca22=_0x7223bd['map'](_0x4a8387=>_0x4a8387['toJSON']());return this['_compressor']['compress'](_0x54ca22);}['_decompressOperations'](_0x8e3e4f,_0x39f1df){return this['_compressor']['decompress'](_0x8e3e4f)['map']((_0x5d3e86,_0x347d53)=>{const _0x21d292='init'==_0x39f1df[_0x347d53]['type'];if('InsertOperation'==_0x5d3e86['__className']){const _0x187720=_0x5d3e86['position']['root'];!this['_document']['getRoot'](_0x187720)&&(this['_document']['createRoot']('$root',_0x187720)['_isAttached']=!0x1);}const _0x59f75b=_0x1da48c['fromJSON'](_0x5d3e86,this['_document']);return _0x59f75b['wasUndone']=_0x5d3e86['wasUndone'],_0x59f75b['_isInit']=_0x21d292,_0x59f75b['_authorId']=_0x21d292?null:_0x39f1df[_0x347d53]['userId'],_0x59f75b['_isDisconnection']='cs:removeUser'===_0x39f1df[_0x347d53]['type'],_0x59f75b['createdAt']=_0x39f1df[_0x347d53]['createdAt'],_0x59f75b;});}['_refreshUserSelectionMarkers'](){this['_hasSelectionChanged']=!0x0,this['_shouldSendSelectionUpdate']()?this['_sendBufferedOperationsDelayed']():this['_hasSelectionChanged']=!0x1;}['_shouldSendSelectionUpdate'](){const _0x2b1961=this['editor']['plugins']['get'](r)['channelSessions']['get'](this['_channelId']);return!this['editor']['isReadOnly']&&!!_0x2b1961&&_0x2b1961['length']>0x1&&this['_hasSelectionChanged'];}['_shouldSendUpdate'](){return this['_bufferedOperations']['length']>0x0||this['_shouldSendSelectionUpdate']();}}class J extends Error{}function Q(_0xec5272,_0x37b89e){for(const _0x4d7f68 of _0xec5272)_0x4d7f68['baseVersion']=_0x37b89e++;}class X{['_ignoredOperations'];['_operationToId'];constructor(_0x125918){this['_ignoredOperations']=_0x125918,this['_operationToId']=new WeakMap();}['getIdOfTheLastOperation'](_0x19183a){let _0x267443=_0x19183a['length'];for(;_0x267443--;){const _0x4f58d9=_0x19183a[_0x267443];if(!this['_ignoredOperations']['has'](_0x4f58d9)){if(!this['_operationToId']['has'](_0x4f58d9)){const _0xfb8979=_0x5b9fef()['slice'](0x1,0x12);this['_operationToId']['set'](_0x4f58d9,_0xfb8979);}return this['_operationToId']['get'](_0x4f58d9);}}}['setIdForTheLastOperation'](_0x33fc84,_0x1eed9e){if(!_0x1eed9e)return;let _0x20e19f=_0x33fc84['length'];for(;_0x20e19f--;){const _0x38aee0=_0x33fc84[_0x20e19f];this['_ignoredOperations']['has'](_0x38aee0)||this['_operationToId']['set'](_0x38aee0,_0x1eed9e);}}}class n extends _0x24fdff{static get['requires'](){return[l];}static get['pluginName'](){return'RealTimeCollaborativeEditing';}}class a extends _0xcc61e9{static ['CommentsService']=/* #__PURE__ -- @preserve */
((()=>_0x2ce4d9)());['_services'];static get['requires'](){return[c,'CommentsRepository',r,_0x56c9c0];}static get['pluginName'](){return'CloudServicesCommentsAdapter';}constructor(_0x94e947){super(_0x94e947),this['_services']=new Map();}async['init'](){const _0x460838=this['context'],_0x1f5d49=_0x460838['plugins']['get']('CommentsRepository');if(_0x460838['plugins']['get'](c)['addToReconnectionStack'](this),_0x1f5d49['adapter']={'addCommentThread':async({channelId:_0xfa3b1c,threadId:_0x2f729b,comments:_0x3653cc,resolvedAt:_0x49ac0b,resolvedBy:_0x1a6928,context:_0x465c05,attributes:_0x48ad56})=>{const _0x10daef=await this['_getService'](_0xfa3b1c)['addCommentThread']({'commentThreadId':_0x2f729b,'comments':_0x3653cc['map'](_0x5a7a2a=>function(_0xe957e,_0x38abee,_0x59955a){return{'commentThreadId':_0x59955a,'commentId':_0xe957e['commentId'],'userId':_0xe957e['authorId'],'content':_0xe957e['content'],'documentId':_0x38abee,'createdAt':_0xe957e['createdAt'],'attributes':_0xe957e['attributes']||{}};}(_0x5a7a2a,_0xfa3b1c,_0x2f729b)),'resolvedAt':_0x49ac0b,'resolvedBy':_0x1a6928,'context':_0x465c05,'attributes':_0x48ad56})['catch'](lt);return{'threadId':_0x10daef['commentThreadId'],'comments':_0x10daef['comments']};},'getCommentThread':async({channelId:_0xc78465,threadId:_0x3a6366})=>{const _0x46fb10=await this['_getService'](_0xc78465)['getCommentThread'](_0x3a6366)['catch'](lt);return await this['_fetchMissingUsersForThreads']([_0x46fb10]),{'threadId':_0x46fb10['commentThreadId'],'comments':_0x46fb10['comments']['map'](R),'context':_0x46fb10['context'],'resolvedAt':_0x46fb10['resolvedAt'],'resolvedBy':_0x46fb10['resolvedBy'],'attributes':_0x46fb10['attributes']||{}};},'updateCommentThread':async({channelId:_0x3fba73,threadId:_0x23f462,context:_0x448e9e,unlinkedAt:_0x27b8fa,attributes:_0x1e764e})=>this['_getService'](_0x3fba73)['updateCommentThread']({'commentThreadId':_0x23f462,'context':_0x448e9e,'attributes':_0x1e764e,'unlinkedAt':_0x27b8fa})['catch'](F)['catch'](lt),'resolveCommentThread':async({channelId:_0x4cbd73,threadId:_0x4ab766})=>{const _0x34475d=await this['_getService'](_0x4cbd73)['resolveCommentThread'](_0x4ab766)['catch'](F)['catch'](lt);return{'threadId':_0x34475d['commentThreadId'],'resolvedAt':_0x34475d['resolvedAt'],'resolvedBy':_0x34475d['resolvedBy']};},'reopenCommentThread':async({channelId:_0x24674b,threadId:_0x111503})=>this['_getService'](_0x24674b)['reopenCommentThread'](_0x111503)['catch'](F)['catch'](lt),'removeCommentThread':({channelId:_0x593a94,threadId:_0xf28f58})=>this['_getService'](_0x593a94)['removeCommentThread'](_0xf28f58)['catch'](F)['catch'](lt),'addComment':({channelId:_0x5da5d6,threadId:_0x34b7b9,commentId:_0x5f12a9,content:_0x30e506,attributes:_0x182ccd})=>this['_getService'](_0x5da5d6)['addComment'](_0x34b7b9,_0x5f12a9,_0x30e506,_0x182ccd)['catch'](lt),'updateComment':({channelId:_0x4c5111,threadId:_0x120eab,commentId:_0x420fea,content:_0x5ba502,attributes:_0xf3e180})=>this['_getService'](_0x4c5111)['updateComment'](_0x120eab,_0x420fea,_0x5ba502,_0xf3e180)['catch'](F)['catch'](lt),'removeComment':({channelId:_0x4561de,threadId:_0x20e1ed,commentId:_0x122be1})=>this['_getService'](_0x4561de)['removeComment'](_0x20e1ed,_0x122be1)['catch'](F)['catch'](lt)},_0x460838 instanceof _0x2ed358){const _0x23f01e=_0x460838['config']['get']('collaboration.channelId'),_0x5e76e3=_0x460838['plugins']['get'](r);await this['_setUpService'](_0x23f01e);const _0x510642=await this['_services']['get'](_0x23f01e)['getConnectedSessions']();this['listenTo'](_0x5e76e3,'sessionAdd:'+_0x23f01e,(_0x11964b,{session:_0x4b6fb5})=>{_0x4b6fb5['id']===_0x5e76e3['mySessionId']&&(_0x11964b['off'](),this['context']['plugins']['get']('Permissions')['setPermissions'](_0x4b6fb5['permissions'],_0x23f01e));}),_0x5e76e3['register'](_0x23f01e,_0x510642);}}async['_setUpService'](_0x5c09c0){if(this['_services']['has'](_0x5c09c0))throw new _0x7d2c8e('cloudservicescommentsadapter-connect-already-connected',null,{'channelId':_0x5c09c0});const _0x85a8db=this['context']['plugins']['get']('CommentsRepository'),_0x2932b2=new a['CommentsService'](_0x5c09c0);this['_services']['set'](_0x5c09c0,_0x2932b2),this['listenTo'](_0x2932b2,'commentThreadAdded',(_0xd1533d,_0x3c57cc)=>{const {commentThreadId:_0x48b26c,documentId:_0x5c213e,context:_0x5534c9,attributes:_0x2d0405,resolvedAt:_0x359cbf,resolvedBy:_0x49ea34,comments:_0x44f4ae}=_0x3c57cc;_0x85a8db['getCommentThread'](_0x48b26c)||_0x85a8db['addCommentThread']({'threadId':_0x48b26c,'channelId':_0x5c213e,'comments':_0x44f4ae?_0x44f4ae['map'](R):[],'context':_0x5534c9,'attributes':_0x2d0405,'resolvedAt':_0x359cbf,'resolvedBy':_0x49ea34,'isFromAdapter':!0x0});}),this['listenTo'](_0x2932b2,'commentThreadUpdated',(_0x2704ea,{commentThreadId:_0x12a2df,documentId:_0x2c6b81,context:_0x521c3,unlinkedAt:_0x276910,attributes:_0x26cfa2})=>{_0x85a8db['getCommentThread'](_0x12a2df)&&_0x85a8db['updateCommentThread']({'threadId':_0x12a2df,'channelId':_0x2c6b81,'context':_0x521c3,'unlinkedAt':_0x276910,'attributes':_0x26cfa2,'isFromAdapter':!0x0});}),this['listenTo'](_0x2932b2,'commentThreadResolved',(_0x58a79c,{commentThreadId:_0x3561a6,resolvedBy:_0xc8b220,resolvedAt:_0x2f036d})=>{const _0x342fb3=_0x85a8db['getCommentThread'](_0x3561a6);_0x342fb3&&_0x342fb3['resolve']({'resolvedBy':_0xc8b220,'resolvedAt':_0x2f036d,'isFromAdapter':!0x0});}),this['listenTo'](_0x2932b2,'commentThreadReopened',(_0x1d4a3b,{commentThreadId:_0x25efa3})=>{const _0x24d477=_0x85a8db['getCommentThread'](_0x25efa3);_0x24d477&&_0x24d477['reopen']({'isFromAdapter':!0x0});}),this['listenTo'](_0x2932b2,'commentThreadRemoved',(_0x5089d9,{commentThreadId:_0x338105})=>{const _0x5c456f=_0x85a8db['getCommentThread'](_0x338105);_0x5c456f&&_0x5c456f['remove']({'isFromAdapter':!0x0});}),this['listenTo'](_0x2932b2,'commentAdded',(_0x32c546,_0x1c4232)=>{const _0x709624=_0x1c4232['commentThreadId'],_0x3db70b=_0x85a8db['getCommentThread'](_0x709624);_0x3db70b&&_0x3db70b['addComment']({...R(_0x1c4232),'isFromAdapter':!0x0});}),this['listenTo'](_0x2932b2,'commentUpdated',(_0x3b5016,{commentThreadId:_0x594ed3,commentId:_0x23fff5,content:_0x51b824,attributes:_0x3a9a61})=>{const _0x399ad5=_0x85a8db['getCommentThread'](_0x594ed3);if(_0x399ad5){const _0x320612=_0x399ad5['getComment'](_0x23fff5);_0x320612&&_0x320612['update']({'content':_0x51b824,'attributes':_0x3a9a61,'isFromAdapter':!0x0});}}),this['listenTo'](_0x2932b2,'commentRemoved',(_0x43f03e,{commentThreadId:_0x22c8c7,commentId:_0xa4c96c})=>{const _0x46188f=_0x85a8db['getCommentThread'](_0x22c8c7);if(_0x46188f){const _0x311963=_0x46188f['getComment'](_0xa4c96c);_0x311963&&_0x311963['remove']({'isFromAdapter':!0x0});}}),await this['_connectService'](_0x5c09c0);}['destroy'](){if(this['context']instanceof _0x2ed358){const _0x4fcbb5=this['context']['config']['get']('collaboration.channelId');this['_terminateService'](_0x4fcbb5);}}['_terminateService'](_0x45a9d6){if(!this['_services']['has'](_0x45a9d6))throw new _0x7d2c8e('cloudservicescommentsadapter-disconnect-not-exist',null,{'channelId':_0x45a9d6});this['_getService'](_0x45a9d6)['disconnect'](),this['_services']['delete'](_0x45a9d6);}async['reconnect'](){for(const _0x129e5 of this['_services']['keys']())await this['_connectService'](_0x129e5);if(this['context']instanceof _0x2ed358){const _0x507a93=this['context']['config']['get']('collaboration.channelId'),_0x1c81fa=this['context']['plugins']['get'](r);_0x1c81fa['unregister'](_0x507a93);const _0x43369f=await this['_services']['get'](_0x507a93)['getConnectedSessions']();_0x1c81fa['register'](_0x507a93,_0x43369f);}}async['_connectService'](_0x57e755){const {connection:_0x14fbc0}=this['context']['plugins']['get'](c),_0x5222d0=this['context']['plugins']['get']('CommentsRepository'),_0x1059b1=this['_services']['get'](_0x57e755),_0x18d197=await _0x1059b1['connect'](_0x14fbc0);await this['_fetchMissingUsersForThreads'](_0x18d197);const _0x29cbb6=new Set(Array['from'](_0x5222d0['getCommentThreads']({'channelId':_0x57e755}),_0x223ddf=>_0x223ddf['id']));for(const _0x2dde78 of _0x18d197)_0x2dde78['deletedAt']||_0x29cbb6['delete'](_0x2dde78['commentThreadId']);for(const _0x482732 of _0x29cbb6)_0x5222d0['getCommentThread'](_0x482732)['remove']({'isFromAdapter':!0x0});for(const _0x3506a4 of _0x18d197){let _0x1f3ec4=_0x5222d0['getCommentThread'](_0x3506a4['commentThreadId']);const {commentThreadId:_0x4f9601,context:_0x19bd8b,attributes:_0x3e6dc2,resolvedBy:_0x41eb5c,resolvedAt:_0x52125b,unlinkedAt:_0x56b417,deletedAt:_0x5610f0}=_0x3506a4;if(_0x5610f0)continue;_0x1f3ec4||(_0x1f3ec4=_0x5222d0['addCommentThread']({'channelId':_0x57e755,'threadId':_0x4f9601,'context':_0x19bd8b,'attributes':_0x3e6dc2||{},'resolvedBy':_0x41eb5c,'resolvedAt':_0x52125b,'unlinkedAt':_0x56b417,'isFromAdapter':!0x0}));const _0x3e982c=new Set(Array['from'](_0x1f3ec4['comments'],_0x3068fe=>_0x3068fe['id']));for(const _0x3a3346 of _0x3506a4['comments'])_0x3e982c['delete'](_0x3a3346['commentId']);for(const _0x5af874 of _0x3e982c)_0x1f3ec4['getComment'](_0x5af874)['remove']({'isFromAdapter':!0x0});for(const _0x224411 of _0x3506a4['comments']){const _0x3c3c07=_0x1f3ec4['getComment'](_0x224411['commentId']);_0x3c3c07?_0x3c3c07['content']!==_0x224411['content']&&_0x3c3c07['update']({'content':_0x224411['content'],'isFromAdapter':!0x0}):_0x1f3ec4['addComment'](Object['assign'](R(_0x224411),{'isFromAdapter':!0x0}));}}}['_getService'](_0x5e4877){if(!this['_services']['has'](_0x5e4877))throw new _0x7d2c8e('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x5e4877});return this['_services']['get'](_0x5e4877);}async['_fetchMissingUsersForThreads'](_0xededde){const _0x24db55=this['context']['plugins']['get'](_0x56c9c0),{connection:_0x2e9d37}=this['context']['plugins']['get'](c),_0x42ea03=new Set();for(const {resolvedBy:_0x483a46,comments:_0xe5ab8}of _0xededde){_0x483a46&&!_0x24db55['getUser'](_0x483a46)&&_0x42ea03['add'](_0x483a46);for(const {userId:_0x41d939}of _0xe5ab8)_0x24db55['getUser'](_0x41d939)||_0x42ea03['add'](_0x41d939);}if(0x0===_0x42ea03['size'])return;const _0x15ad20=await dt['getMany'](_0x2e9d37,Array['from'](_0x42ea03));for(const _0x21114e of _0x15ad20)_0x24db55['getUser'](_0x21114e['id'])||_0x24db55['addUser'](_0x21114e);}}async function F(_0x40eb97){if('404'!==_0x40eb97['code'])throw _0x40eb97;}function lt(_0x3ab367){if((_0x16e0d1=_0x3ab367)['message']['startsWith']('cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.')||_0x16e0d1['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x16e0d1['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.'))return new Promise(()=>{});var _0x16e0d1;throw _0x3ab367;}function R(_0xe92094){return{'threadId':_0xe92094['commentThreadId'],'commentId':_0xe92094['commentId'],'content':_0xe92094['content'],'createdAt':_0xe92094['createdAt'],'authorId':_0xe92094['userId'],'attributes':_0xe92094['attributes']||{}};}class g extends _0x24fdff{static ['TrackChangesService']=/* #__PURE__ -- @preserve */
((()=>et)());['_bufferedRequests'];['_trackChangesService'];static get['requires'](){return[a,'TrackChangesEditing',c];}constructor(_0x401624){super(_0x401624);const _0x5f4744=this['editor']['config']['get']('collaboration.channelId');this['_bufferedRequests']=new Map(),this['_trackChangesService']=new g['TrackChangesService'](_0x5f4744);}['init'](){const _0x5db2c3=this['editor']['plugins']['get'](c),_0x32f691=this['editor']['plugins']['get']('TrackChangesEditing');return _0x32f691['adapter']={'getSuggestion':async _0x120b2f=>{await this['_waitForServiceReady']();const _0x8e995=await this['_trackChangesService']['get'](_0x120b2f)['catch'](B);return await this['_fetchMissingUsersForThreads']([_0x8e995]),_0x8e995;},'addSuggestion':async({id:_0x2e283d,type:_0x27776d,data:_0x4b8c58,originalSuggestionId:_0x499741,attributes:_0x5b2d14})=>{await this['_waitForServiceReady']();const _0x2f3e43={'id':_0x2e283d,'type':_0x27776d,'data':_0x4b8c58,'originalSuggestionId':_0x499741,'attributes':_0x5b2d14},_0x9f7412=await this['_trackChangesService']['add'](_0x2e283d,_0x27776d,_0x4b8c58,_0x499741,_0x5b2d14)['catch'](_0x5e5791=>{if(ut(_0x5e5791))return new Promise(_0x1c7462=>{this['_bufferedRequests']['set'](_0x2e283d,{'resolve':_0x1c7462,'suggestionData':_0x2f3e43});});throw _0x5e5791;});return this['_bufferedRequests']['delete'](_0x2e283d),_0x9f7412;},'updateSuggestion':async(_0x58ee9d,_0x4edad6)=>{if(await this['_waitForServiceReady'](),'open'!==_0x4edad6['state'])return this['_trackChangesService']['update'](_0x58ee9d,_0x4edad6)['catch'](B);}},this['listenTo'](this['_trackChangesService'],'suggestionUpdated',(_0x1c5100,_0x1808cb)=>{_0x32f691['hasSuggestion'](_0x1808cb['id'])&&(_0x32f691['getSuggestion'](_0x1808cb['id'])['attributes']=_0x1808cb['attributes']);}),this['_trackChangesService']['connect'](_0x5db2c3['connection'])['then'](_0x1869c4=>(_0x5db2c3['addToReconnectionStack'](this),this['_fetchMissingUsersForThreads'](_0x1869c4)['then'](()=>{for(const _0x2aa090 of _0x1869c4){_0x32f691['addSuggestionData'](_0x2aa090)['_saved']=!0x0;}})));}async['reconnect'](){const _0x399b7b=this['editor']['plugins']['get']('TrackChangesEditing'),{connection:_0x494bdc}=this['editor']['plugins']['get'](c),_0x2d757c=await this['_trackChangesService']['connect'](_0x494bdc);await this['_fetchMissingUsersForThreads'](_0x2d757c);for(const {suggestionData:_0x470d44,resolve:_0x2aebc9}of this['_bufferedRequests']['values']()){let _0x14ff5e=_0x2d757c['find'](_0x3b307f=>_0x3b307f['id']===_0x470d44['id']);_0x14ff5e||(_0x14ff5e=await this['_trackChangesService']['add'](_0x470d44['id'],_0x470d44['type'],_0x470d44['data'],_0x470d44['originalSuggestionId'])),_0x2aebc9(_0x14ff5e);}for(const _0x5e8952 of _0x2d757c)_0x399b7b['hasSuggestion'](_0x5e8952['id'])||_0x399b7b['addSuggestionData'](_0x5e8952);}async['_waitForServiceReady'](){this['_trackChangesService']['isConnected']||await new Promise(_0x425a23=>{this['listenTo'](this['_trackChangesService'],'connected',_0x3fa63c=>{_0x3fa63c['off'](),_0x425a23();});});}async['_fetchMissingUsersForThreads'](_0x314f4d){const _0x192a4e=this['editor']['plugins']['get'](_0x56c9c0),{connection:_0x24a6e7}=this['editor']['plugins']['get'](c),_0x430f5d=new Set();for(const {authorId:_0x2df4a6}of _0x314f4d)_0x192a4e['getUser'](_0x2df4a6)||_0x430f5d['add'](_0x2df4a6);if(0x0===_0x430f5d['size'])return;const _0x4dd4ed=await dt['getMany'](_0x24a6e7,Array['from'](_0x430f5d));for(const _0x278346 of _0x4dd4ed)_0x192a4e['getUser'](_0x278346['id'])||_0x192a4e['addUser'](_0x278346);}}function B(_0x2c3def){if(ut(_0x2c3def))return new Promise(()=>{});throw _0x2c3def;}function ut(_0x5dcdb9){return _0x5dcdb9['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x5dcdb9['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class m extends _0x24fdff{static get['requires'](){return['Comments',a,n,c];}static get['pluginName'](){return'RealTimeCollaborativeComments';}['init'](){const _0x27459b=this['editor']['plugins']['get'](c),_0x1b3453=this['editor']['plugins']['get']('CommentsEditing'),_0x6e0ca9=this['editor']['plugins']['get'](a);return this['editor']['data']['once']('ready',()=>{this['listenTo'](_0x27459b,'change:state',(_0x2aea9c,_0x24cdae,_0x1b44a8)=>{_0x1b3453['isThreadsLoadingPaused']='connected'!==_0x1b44a8;});}),this['listenTo'](_0x27459b,'change:state',(_0x11dace,_0x2373fe,_0x3cdf03)=>{this['editor']['plugins']['get']('CommentsRepository')['switchReadOnly']('connected'!==_0x3cdf03);}),_0x6e0ca9['_setUpService'](this['editor']['config']['get']('collaboration.channelId'));}['destroy'](){this['editor']['plugins']['get'](a)['_terminateService'](this['editor']['config']['get']('collaboration.channelId')),super['destroy']();}}class p extends _0x24fdff{static get['requires'](){return[m,g,'TrackChanges'];}static get['pluginName'](){return'RealTimeCollaborativeTrackChanges';}}class v extends _0x24fdff{static ['RevisionHistoryService']=/* #__PURE__ -- @preserve */
((()=>it)());['_lastRequestId'];['_revisionTracker'];['_revisionHistoryService'];['_oldOffset'];static get['requires'](){return[c,l,'RevisionTracker',r,_0x56c9c0];}constructor(_0x272165){super(_0x272165);const _0x4e7cf3=this['editor']['config']['get']('collaboration.channelId');this['_lastRequestId']=null,this['_revisionTracker']=this['editor']['plugins']['get']('RevisionTracker'),this['_revisionHistoryService']=new v['RevisionHistoryService'](_0x4e7cf3);}async['init'](){const _0x4e5f66=this['editor']['plugins']['get'](l),_0x56fa85=_0x4e5f66['serverHistory'],_0x2970eb=this['editor']['plugins']['get'](c);this['_revisionTracker']['setSource']({'history':_0x56fa85,'getLatestVersion':()=>this['_getLatestVersion'](),'getCurrentRevisionId':()=>_0x4e5f66['sessionId']});const _0x3b2881=this['editor']['config']['get']('cloudServices.bundleVersion')||nt,_0x39f64a=await tt['isBundleUploaded'](_0x2970eb['connection'],_0x3b2881);this['_revisionTracker']['adapter']={'getRevision':async({revisionId:_0xa4acb2})=>(await this['_waitForServiceReady'](),await this['_revisionHistoryService']['getRevision'](_0xa4acb2)),'updateRevisions':async _0x402ee9=>{await this['_waitForServiceReady']();const _0x10d90a=this['_revisionTracker']['currentRevision'];if(_0x39f64a&&0x1===_0x402ee9['length']&&_0x402ee9[0x0]['id']===_0x10d90a['id'])return _0x402ee9;for(const _0x9e9aa0 of _0x402ee9)_0x9e9aa0['id']===_0x10d90a['id']&&(_0x9e9aa0['isEmptyCurrent']=_0x9e9aa0['fromVersion']===_0x9e9aa0['toVersion']);return this['_revisionHistoryService']['updateRevisions'](_0x402ee9,this['_lastRequestId'])['then'](_0x2330c2=>(this['_lastRequestId']=_0x2330c2,_0x402ee9))['catch'](_0x10696b=>{if(st(_0x10696b)||'400'===_0x10696b['code']&&void 0x0!==_0x10696b['data']['wrongRequestId']){for(const _0x417841 of _0x402ee9){!this['_revisionTracker']['repository']['getRevision'](_0x417841['id'])||this['_revisionTracker']['_bufferUpdate'](_0x417841['id'],_0x417841,!0x1);}if(st(_0x10696b))throw _0x10696b;return _0x402ee9;}throw _0x10696b;});}},this['listenTo'](this['_revisionHistoryService'],'revisionsUpdated',(_0x527004,{revisionsData:_0x9055f7,requestId:_0x3ea463})=>{Math['max'](..._0x9055f7['map'](_0x5ef679=>_0x5ef679['toVersion']))>this['_getLatestVersionFromServerOperations']()-0x1?this['_getLatestVersion']()['then'](()=>{this['_handleRevisionsUpdate'](_0x9055f7,_0x3ea463);}):this['_handleRevisionsUpdate'](_0x9055f7,_0x3ea463);});const {revisions:_0x23f626,requestId:_0x404fba}=await this['_revisionHistoryService']['connect'](_0x2970eb['connection']);_0x2970eb['addToReconnectionStack'](this),this['_lastRequestId']=_0x404fba,await this['_fetchMissingUsers'](_0x23f626);for(const _0x3bed34 of _0x23f626)this['_revisionTracker']['addRevisionData'](_0x3bed34);this['listenTo'](_0x4e5f66,'change:_isConnected',(_0x1cd075,_0x4e12cc,_0xddb74a)=>{_0xddb74a&&(this['_oldOffset']=_0x4e5f66['_offset'],_0x1cd075['off']());}),this['_revisionTracker']['bind']('isEnabled')['to'](_0x2970eb,'state',_0x272b50=>_0x272b50===_0x5ce1bc['CONNECTED']);}async['reconnect'](){const _0x15b580=this['editor']['plugins']['get'](c),_0x290ddf=this['editor']['plugins']['get'](l),_0x55d585=async()=>{const _0x19c26e=this['_revisionTracker']['currentRevision'],_0x3a6afe=_0x19c26e['id'],_0x3f91ea=_0x3a6afe!==_0x290ddf['sessionId'];if(_0x3f91ea){const _0x1ce9a6=_0x290ddf['_offset']-this['_oldOffset'],_0x20b905=this['_getLatestVersionFromServerOperations']();this['_revisionTracker']['_revisionDataBuilder']['reInit']();if(_0x19c26e['toVersion']+_0x1ce9a6!==_0x20b905){const _0x5c9716=_0x19c26e['fromVersion']+_0x1ce9a6,_0xf5f4be=this['editor']['plugins']['get'](_0x56c9c0),_0x3d586b=this['_revisionTracker']['buildRevisionData']({'revision':_0x19c26e,'from':_0x5c9716,'to':_0x20b905});_0x3d586b['id']=_0x19c26e['id'];const _0x2eac5c=_0x3d586b['authorsIds']['map'](_0x5b43e5=>_0xf5f4be['getUser'](_0x5b43e5));_0x19c26e['_update']({..._0x3d586b,'authors':_0x2eac5c},!0x0),this['_revisionTracker']['_bufferUpdate'](_0x19c26e['id'],_0x3d586b,!0x0);}this['_revisionTracker']['_startingVersion']=_0x20b905,(_0x19c26e['toVersion']===_0x19c26e['fromVersion']&&!this['_revisionTracker']['_bufferedUpdates']['has'](_0x3a6afe)&&this['_revisionTracker']['repository']['_revisions']['remove'](_0x3a6afe),this['_revisionTracker']['_createCurrentRevision'](_0x20b905));}const {revisions:_0x34cfe0,requestId:_0x34901c}=await this['_revisionHistoryService']['reconnect'](_0x15b580['connection'],this['_lastRequestId']);_0x3f91ea&&_0x34cfe0['length']>0x0?_0x290ddf['_handleReconnectionError']():(await this['_fetchMissingUsers'](_0x34cfe0),this['_handleRevisionsUpdate'](_0x34cfe0,_0x34901c),this['_revisionTracker']['sendBufferedUpdates']());};return _0x290ddf['_isConnected']?_0x55d585():new Promise((_0x4d481f,_0x4704b9)=>{_0x290ddf['once']('change:_isConnected',()=>{_0x55d585()['then'](_0x4d481f)['catch'](_0x4704b9);});});}['destroy'](){super['destroy']();}async['_waitForServiceReady'](){this['_revisionHistoryService']['isConnected']||await new Promise(_0x5237bc=>{this['listenTo'](this['_revisionHistoryService'],'connected',_0xd6a0c3=>{_0xd6a0c3['off'](),_0x5237bc();});});}['_getLatestVersionFromServerOperations'](){const _0x145ddd=this['editor']['plugins']['get'](l)['serverHistory']['getOperations']()['reverse']();for(const _0xaa6477 of _0x145ddd)if('marker'!==_0xaa6477['type']||_0xaa6477['affectsData'])return _0xaa6477['baseVersion']+0x1;}['_getLatestVersion'](){const _0x34ca19=this['editor']['plugins']['get'](l);return new Promise(_0x5b5a83=>{_0x34ca19['_isPendingUpdate']?_0x34ca19['once']('change:_isPendingUpdate',()=>{_0x5b5a83(this['_getLatestVersionFromServerOperations']());}):_0x5b5a83(this['_getLatestVersionFromServerOperations']());});}['_handleRevisionsUpdate'](_0x57f197,_0x4258a3){const _0x2b99bb=this['_revisionTracker']['repository'];this['_lastRequestId']=_0x4258a3;for(const _0x3cbe55 of _0x57f197){const _0x5f1771=_0x2b99bb['getRevision'](_0x3cbe55['id']);if(_0x5f1771){if((_0x3cbe55['fromVersion']||_0x3cbe55['toVersion'])&&(_0x3cbe55['diffData']=null),_0x5f1771===this['_revisionTracker']['currentRevision']){const _0x4ea7df=Math['max'](_0x5f1771['toVersion'],_0x3cbe55['toVersion']),_0x51a9ca=Math['max'](_0x5f1771['fromVersion'],_0x3cbe55['fromVersion']);let _0x45e549;_0x5f1771['toVersion']===_0x3cbe55['toVersion']&&_0x5f1771['fromVersion']===_0x3cbe55['fromVersion']?(_0x45e549=!0x0,this['_preventResendingRevisionData'](_0x3cbe55)):_0x3cbe55['toVersion']===_0x4ea7df&&_0x3cbe55['fromVersion']===_0x51a9ca?_0x45e549=!0x1:(_0x5f1771['toVersion']===_0x4ea7df&&_0x5f1771['fromVersion']===_0x51a9ca||this['_fixRevision']({'revision':_0x5f1771,'from':_0x51a9ca,'to':_0x4ea7df}),_0x45e549=!0x0),_0x45e549&&(delete _0x3cbe55['fromVersion'],delete _0x3cbe55['toVersion'],delete _0x3cbe55['diffData'],delete _0x3cbe55['createdAt'],delete _0x3cbe55['authorsIds']);}this['_revisionTracker']['setRevisionData'](_0x3cbe55),this['_preventResendingRevisionData'](_0x3cbe55);}else this['_revisionTracker']['addRevisionData'](_0x3cbe55);}const _0x553964=_0x2b99bb['getRevisions']();_0x553964['reverse']();for(let _0x35badf=0x0;_0x35badf<_0x553964['length']-0x1;_0x35badf++){const _0x42aa78=_0x553964[_0x35badf],_0x2502a6=_0x553964[_0x35badf+0x1];if(_0x42aa78['fromVersion']<_0x2502a6['toVersion']){const _0x3a7528=_0x2502a6['toVersion'],_0xc89f01=Math['max'](_0x3a7528,_0x42aa78['toVersion']);this['_fixRevision']({'revision':_0x42aa78,'from':_0x3a7528,'to':_0xc89f01});}}}['_fixRevision']({revision:_0x5bdd31,from:_0x393392,to:_0x58afde}={}){const _0x1f46cd=this['editor']['plugins']['get'](_0x56c9c0),_0x171054=this['_revisionTracker']['buildRevisionData']({'revision':_0x5bdd31,'from':_0x393392,'to':_0x58afde});_0x171054['authors']=_0x171054['authorsIds']['map'](_0x521df1=>_0x1f46cd['getUser'](_0x521df1)),_0x5bdd31['_update'](_0x171054);}['_preventResendingRevisionData'](_0x84fdb0){const _0x517a4c={};_0x517a4c['id']=_0x84fdb0['id'];for(const _0x243fb4 of Object['keys'](_0x84fdb0))'id'!==_0x243fb4&&(_0x517a4c[_0x243fb4]=void 0x0);this['_revisionTracker']['_bufferUpdate'](_0x517a4c['id'],_0x517a4c,!0x0);}async['_fetchMissingUsers'](_0x4f865a){const _0x1eb0ec=this['editor']['plugins']['get'](_0x56c9c0),{connection:_0x33f9c9}=this['editor']['plugins']['get'](c),_0x1c4a2d=new Set();for(const _0x458aed of _0x4f865a){for(const _0x31a8bc of _0x458aed['authorsIds'])_0x3e78a1(_0x31a8bc);_0x458aed['creatorId']&&_0x3e78a1(_0x458aed['creatorId']);}if(0x0===_0x1c4a2d['size'])return;const _0x113b00=await dt['getMany'](_0x33f9c9,Array['from'](_0x1c4a2d));for(const _0x369e08 of _0x113b00)_0x1eb0ec['getUser'](_0x369e08['id'])||_0x1eb0ec['addUser'](_0x369e08);function _0x3e78a1(_0x3c3cc6){_0x1eb0ec['getUser'](_0x3c3cc6)||_0x1c4a2d['add'](_0x3c3cc6);}}}function st(_0x53ac50){return _0x53ac50['message']['startsWith']('cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.')||_0x53ac50['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x53ac50['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class d extends _0x24fdff{static get['requires'](){return['RevisionHistory',v,n];}static get['pluginName'](){return'RealTimeCollaborativeRevisionHistory';}}class ts extends _0x3d2e32{constructor(_0x4ca8c8){super(_0x4ca8c8);const _0x45107c=this['bindTemplate'];this['set']('usersCount',0x0),this['set']('isHidden',!0x0),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__counter',_0x45107c['if']('isHidden','ck-presence-list__counter--hidden')]},'children':[{'text':_0x45107c['to']('usersCount',_0x1fcc45=>q(_0x4ca8c8,'CONNECTED_USERS',_0x1fcc45))}]});}}class rt extends _0x3d2e32{['items'];constructor(_0x450149){super(_0x450149),this['items']=this['createCollection']();const _0x422b73=this['bindTemplate'];this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__list']},'children':this['items'],'on':{'click':_0x422b73['to'](()=>this['fire']('execute'))}});}}class k extends _0x3d2e32{['counterView'];['inlineListView'];constructor(_0x25a027){super(_0x25a027);const _0x1927ed=this['bindTemplate'];this['set']('isCollapsed',!0x0),this['counterView']=new ts(this['locale']),this['inlineListView']=new rt(_0x25a027),this['listenTo'](this['inlineListView']['items'],'change',()=>{for(const _0x3e246d of this['inlineListView']['items'])_0x3e246d['tooltipPosition']='s';this['inlineListView']['items']['first']&&(this['inlineListView']['items']['first']['tooltipPosition']='se');}),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list','ck-reset','ck-rounded-corners',_0x1927ed['if']('isCollapsed','ck-presence-list--collapsed')]},'children':[this['counterView'],this['inlineListView']]});}}class x extends _0x3d2e32{['items'];constructor(_0x3359e4){super(_0x3359e4),this['items']=this['createCollection'](),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__dropdown-list']},'children':[{'tag':'div','attributes':{'class':['ck','ck-presence-list__dropdown-list-wrapper']},'children':this['items']}]});}}class y extends _0x3d2e32{['userView'];constructor(_0x1f1695,_0x2f5b34,_0x3412e5){super(_0x1f1695);const _0x3131f2=this['bindTemplate'];this['userView']=new ct(_0x1f1695,_0x2f5b34);const _0x3f415b={'tag':'div','attributes':{'class':['ck','ck-presence-list__dropdown-list-item']},'children':[this['userView'],{'tag':'span','attributes':{'class':['ck','ck-user__full-name']},'children':[{'text':_0x2f5b34['name']}]},{'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x2f5b34['color']['getBackgroundColorClass']()],'aria-hidden':'true'}}]};_0x3412e5&&(_0x3f415b['tag']='button',_0x3f415b['on']={'click':_0x3131f2['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x3f415b);}}class A extends _0x3d2e32{['userView'];['markerView'];constructor(_0xf84549,_0x1870d2,_0x4269ff){super(_0xf84549);const _0x30ec8b=this['bindTemplate'];this['set']('hasTooltip',!0x0),this['set']('tooltipPosition',''),this['userView']=new ct(_0xf84549,_0x1870d2),this['markerView']=new ot(_0xf84549,_0x1870d2);const _0x12f2ea={'tag':'div','attributes':{'class':['ck','ck-presence-list__list-item'],'data-cke-tooltip-text':this['userView']['name'],'data-cke-tooltip-position':_0x30ec8b['to']('tooltipPosition'),'data-cke-tooltip-disabled':_0x30ec8b['to']('hasTooltip',_0x57a2c9=>!_0x57a2c9),'data-cke-tooltip-class':'ck-presence-list__list-item__tooltip'},'children':[this['userView'],this['markerView']]};_0x4269ff&&(_0x12f2ea['tag']='button',_0x12f2ea['on']={'click':_0x30ec8b['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x12f2ea);}}class ot extends _0x3d2e32{constructor(_0x19863c,_0x2dae82){super(_0x19863c),this['setTemplate']({'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x2dae82['color']['getBackgroundColorClass']()],'aria-hidden':'true'}});}}const _={'collapseAt':0x6,'displayMe':!0x0};class s extends _0xcc61e9{['currentDisplayedUsers'];['balloonPanelView'];['view'];['presenceDropdownView'];['_bodyCollection'];constructor(_0xcc3d08){super(_0xcc3d08),this['context']['config']['define']('presenceList',_);const _0x1953da=_0xcc3d08['config']['get']('presenceList.collapseAt');if('number'!=typeof _0x1953da)throw new _0x7d2c8e('presencelist-collapseat-invalid-format',this);if(_0x1953da<0x1)throw new _0x7d2c8e('presencelist-collapseat-invalid-format',this);this['_allConnectedUsers']=this['context']['plugins']['get'](r)['allConnectedUsers'],this['set']('usersCount',0x0),this['currentDisplayedUsers']=new _0x223e77(),this['balloonPanelView']=new _0x1e6801(),this['balloonPanelView']['class']='ck\x20ck-presence-list__balloon',this['view']=this['_createView'](),this['presenceDropdownView']=void 0x0;}static get['requires'](){return[r];}['init'](){for(const _0x5e705e of this['_allConnectedUsers'])this['_handleUserAdd'](_0x5e705e);this['listenTo'](this['_allConnectedUsers'],'add',(_0x5e4041,_0x50f298)=>{this['_handleUserAdd'](_0x50f298);}),this['listenTo'](this['_allConnectedUsers'],'remove',(_0x458659,_0x2a899f)=>{this['_handleUserRemove'](_0x2a899f);});}['_createView'](){const _0x4d6166=this['context'],_0x3f5b5c=new k(this['context']['locale']),_0x3d3b1d=this['balloonPanelView'];if(!_0x351fa7(_0x4d6166['config']['get']('presenceList.container')))throw new _0x7d2c8e('presencelist-missing-container',this);return _0x3f5b5c['counterView']['bind']('usersCount')['to'](this),_0x3f5b5c['bind']('isCollapsed')['to'](this,'usersCount',_0xb038ce=>{const {collapseAt:_0x3ff12a,displayMe:_0x2f10ab}=_0x4d6166['config']['get']('presenceList'),_0x2cc3ac=_0xb038ce>=_0x3ff12a;return _0x3f5b5c['counterView']['isHidden']=!(0x1==_0xb038ce&&_0x2f10ab||_0x2cc3ac),_0x2cc3ac||this['hideDropdown'](),_0x2cc3ac;}),_0x3f5b5c['inlineListView']['items']['bindTo'](this['currentDisplayedUsers'])['using'](_0x29de8c=>{const _0x3ac426=_0x4d6166['config']['get']('presenceList'),_0x1a2948=new A(_0x4d6166['locale'],_0x29de8c,!!_0x3ac426['onClick']);return _0x1a2948['bind']('hasTooltip')['to'](_0x3f5b5c,'isCollapsed',_0x28f5ec=>!_0x28f5ec),_0x3ac426['onClick']&&this['listenTo'](_0x1a2948,'execute',()=>{this['view']['isCollapsed']||_0x3ac426['onClick'](_0x29de8c,_0x1a2948['element']);}),_0x1a2948;}),this['listenTo'](_0x3f5b5c['inlineListView'],'execute',()=>{this['presenceDropdownView']?this['hideDropdown']():this['view']['isCollapsed']&&this['showDropdown']();}),_0x3f5b5c['render'](),_0x3d3b1d['render'](),_0x443e4a({'emitter':_0x3f5b5c,'activator':()=>_0x3d3b1d['isVisible'],'contextElements':[_0x3d3b1d['element'],_0x3f5b5c['inlineListView']['element']],'callback':()=>this['hideDropdown']()}),_0x4d6166['config']['get']('presenceList.container')['appendChild'](_0x3f5b5c['element']),this['_bodyCollection']=new _0x3291e9(this['context']['locale']),this['_bodyCollection']['attachToDom'](),this['_bodyCollection']['add'](_0x3d3b1d),_0x3f5b5c;}['_handleUserAdd'](_0x190e2f){if(!this['context']['config']['get']('presenceList.displayMe')&&_0x190e2f['isMe'])return;const _0x393dcc=this['context']['config']['get']('presenceList.collapseAt')-0x1;this['usersCount']++,this['currentDisplayedUsers']['length']==_0x393dcc&&this['currentDisplayedUsers']['remove'](0x0);const _0x4a44f2=this['_calculateNewUserPosition'](_0x190e2f);this['currentDisplayedUsers']['add'](_0x190e2f,_0x4a44f2);}['_handleUserRemove'](_0x35a373){if(this['usersCount']--,this['currentDisplayedUsers']['get'](_0x35a373['id'])&&(this['currentDisplayedUsers']['remove'](_0x35a373['id']),this['currentDisplayedUsers']['length']<this['usersCount'])){for(const _0x3973dc of Array['from'](this['_allConnectedUsers'])['reverse']())if(!this['currentDisplayedUsers']['get'](_0x3973dc['id']))return void this['currentDisplayedUsers']['add'](_0x3973dc,0x0);}}['_calculateNewUserPosition'](_0x4d68c4){return Boolean(this['currentDisplayedUsers']['last']&&this['currentDisplayedUsers']['last']['isMe'])&&!_0x4d68c4['isMe']?this['currentDisplayedUsers']['length']-0x1:this['currentDisplayedUsers']['length'];}['showDropdown'](){if(this['presenceDropdownView'])return;this['presenceDropdownView']=new x(this['context']['locale']);const _0x4bf151=this['context']['config']['get']('presenceList');this['presenceDropdownView']['items']['bindTo'](this['_allConnectedUsers'])['using'](_0x1e7721=>{if(!_0x4bf151['displayMe']&&_0x1e7721['isMe'])return null;const _0x1337f6=new y(this['context']['locale'],_0x1e7721,!!_0x4bf151['onClick']);return _0x4bf151['onClick']&&this['listenTo'](_0x1337f6,'execute',()=>{_0x4bf151['onClick'](_0x1e7721,_0x1337f6['element']);}),_0x1337f6;}),this['balloonPanelView']['content']['add'](this['presenceDropdownView']),this['balloonPanelView']['pin']({'target':this['view']['inlineListView']['element']});}['hideDropdown'](){this['presenceDropdownView']&&(this['balloonPanelView']['unpin'](),this['balloonPanelView']['content']['remove'](this['presenceDropdownView']),this['presenceDropdownView']['destroy'](),this['presenceDropdownView']=void 0x0);}['destroy'](){super['destroy'](),this['view']&&this['view']['isRendered']&&this['view']['destroy'](),this['_bodyCollection']&&this['_bodyCollection']['detachFromDom']();}}class i extends _0xcc61e9{static get['requires'](){return[r,s];}static get['pluginName'](){return'PresenceList';}}export{a as CloudServicesCommentsAdapter,v as CloudServicesRevisionHistoryAdapter,g as CloudServicesTrackChangesAdapter,i as PresenceList,l as RealTimeCollaborationClient,m as RealTimeCollaborativeComments,n as RealTimeCollaborativeEditing,d as RealTimeCollaborativeRevisionHistory,p as RealTimeCollaborativeTrackChanges};